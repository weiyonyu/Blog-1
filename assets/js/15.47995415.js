(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{343:function(t,s,a){t.exports=a.p+"assets/img/1.4be4ef6b.png"},344:function(t,s,a){t.exports=a.p+"assets/img/2.a92e0cea.png"},345:function(t,s,a){t.exports=a.p+"assets/img/3.f19f5175.png"},346:function(t,s,a){t.exports=a.p+"assets/img/4.92a7b2c5.png"},472:function(t,s,a){"use strict";a.r(s);var n=a(13),r=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"nginx入门"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nginx入门"}},[t._v("#")]),t._v(" Nginx入门")]),t._v(" "),s("h2",{attrs:{id:"nginx介绍"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nginx介绍"}},[t._v("#")]),t._v(" Nginx介绍")]),t._v(" "),s("p",[t._v("最简单的系统架构")]),t._v(" "),s("p",[s("img",{attrs:{src:a(343),alt:"image"}})]),t._v(" "),s("blockquote",[s("p",[t._v("问题：客户端到底要将请求发送给哪台服务器")])]),t._v(" "),s("p",[t._v("使用nginx做反向代理")]),t._v(" "),s("p",[s("img",{attrs:{src:a(344),alt:"image"}})]),t._v(" "),s("blockquote",[s("p",[t._v("Nginx帮助我们进行分配服务器")])]),t._v(" "),s("h2",{attrs:{id:"nginx的基本配置介绍"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nginx的基本配置介绍"}},[t._v("#")]),t._v(" Nginx的基本配置介绍")]),t._v(" "),s("p",[t._v("在Nginx的安装目录下，找到conf/nginx.conf，主要结构如下：")]),t._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[t._v("#user  nobody;\nworker_processes  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(";\n#error_log  logs/error.log;\n\n# 以上统称为全局快\n# worker_processes越大，并发能力越强\n\nevents "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    worker_connections  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),t._v(";\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n# events块\n# worker_connections越大，并发能力越强\n\nhttp "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    include       mime.types;\n    default_type  application/octet-stream;\n\t\n    server "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        listen       "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8091")]),t._v(";\n        server_name  localhost;\n\n\t\tlocation / "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            root   html;\n            index  index.html index.htm;\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t\t# location块\n\t\t# root/ ：接收到请求后去root的文件夹查找index资源\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t\n\t# server块\n\t# listen：代表监听的端口号\n\t# localhost：代表接受请求的IP或域名\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n# HTTP块\n# include代表引入一个外部的文件 mime.types中放有大量的媒体类型\n")])])]),s("h2",{attrs:{id:"nginx反向代理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nginx反向代理"}},[t._v("#")]),t._v(" Nginx反向代理")]),t._v(" "),s("h3",{attrs:{id:"正向代理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#正向代理"}},[t._v("#")]),t._v(" 正向代理")]),t._v(" "),s("blockquote",[s("p",[t._v("1.正向代理服务是由客户端设立的")]),t._v(" "),s("p",[t._v("2.客户端了解代理服务器和目标服务器都是谁")]),t._v(" "),s("p",[t._v("3.实现突破访问权限，提高访问的速度，对目标服务器隐藏客户端的ip地址")])]),t._v(" "),s("p",[s("img",{attrs:{src:a(345),alt:"image"}})]),t._v(" "),s("h3",{attrs:{id:"反向代理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#反向代理"}},[t._v("#")]),t._v(" 反向代理")]),t._v(" "),s("blockquote",[s("p",[t._v("1.反向代理服务器是配置在服务端的")]),t._v(" "),s("p",[t._v("2.客户端不知道访问的到底是哪一台服务器")]),t._v(" "),s("p",[t._v("3.达到负载均衡，并且可以隐藏服务器真正的ip地址")])]),t._v(" "),s("p",[s("img",{attrs:{src:a(346),alt:"image"}})]),t._v(" "),s("h3",{attrs:{id:"基于nginx实现反向代理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#基于nginx实现反向代理"}},[t._v("#")]),t._v(" 基于Nginx实现反向代理")]),t._v(" "),s("h4",{attrs:{id:"location路径匹配映射"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#location路径匹配映射"}},[t._v("#")]),t._v(" location路径匹配映射")]),t._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[t._v("# "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(". 精准匹配\nlocation = / "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t#精准主机名后面不能带任何字符串\n\t#例如localhost"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8091")]),t._v("或localhost"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8091")]),t._v("/ 都可以匹配\n    #localhost"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8091")]),t._v("/luojw 不行\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n#"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(". 通用匹配\nlocation /xxx "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t#匹配所有以/xxx开头的路径\n\t#例如"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v("."),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.1")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),t._v("/xxx\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n#"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v(". 正则匹配\nlocation ~ /xxx "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t#匹配包含/xxx的路径\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n#"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(". 匹配开头路径\nlocation ^~ /xxx "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t#匹配所有以/xxx开头的路径\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n#"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v(". 匹配结尾路径\nlocation ~* \\.(gif/jpg/png)$ "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t#匹配以.gif、.jpg或者.png结尾的路径\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n以上匹配的先后顺序规则如下：\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("）精准匹配，若成功，则停止后面的步骤，若没有，继续下面的步骤\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("）普通匹配（若有多个匹配项匹配成功，那么记住最长匹配，并继续下面的匹配步骤）\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("）命中前缀匹配（^~）终止匹配\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("）正则表达式匹配\n")])])]),s("h3",{attrs:{id:"proxy-pass代理转发"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#proxy-pass代理转发"}},[t._v("#")]),t._v(" proxy_pass代理转发")]),t._v(" "),s("p",[t._v("在nginx中配置proxy_pass代理转发时，如果在proxy_pass后面的url加/，表示绝对根路径；如果没有/，表示相对路径，把匹配的路径部分也给代理走。")]),t._v(" "),s("p",[t._v("假设下面四种情况分别用 http://localhost:8091/proxy/test 进行访问。")]),t._v(" "),s("p",[t._v("第一种：\nlocation /proxy {\nproxy_pass http://127.0.0.1/;\n}\n代理到URL：http://127.0.0.1/")]),t._v(" "),s("p",[t._v("第二种（相对于第一种，最后少一个 / ）\nlocation /proxy/ {\nproxy_pass http://127.0.0.1;\n}\n代理到URL：http://127.0.0.1/proxy/test")]),t._v(" "),s("h2",{attrs:{id:"nginx负载均衡"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nginx负载均衡"}},[t._v("#")]),t._v(" Nginx负载均衡")]),t._v(" "),s("p",[t._v("Nginx为我们默认提供了三种负载均衡的策略：")]),t._v(" "),s("ol",[s("li",[t._v("轮询：  将客户端发起的请求，平均分配给每一台服务器")]),t._v(" "),s("li",[t._v("权重：  会将客户端的请求，根据服务器的权重值不同，分配不同的数量")]),t._v(" "),s("li",[t._v("ip_hash:  基于发起请求的客户端的ip地址不同，他始终会将请求发送到指定的服务器上  就是说如果这个客户端的请求的ip地址不变，那么处理请求的服务器将一直是同一个")])]),t._v(" "),s("h3",{attrs:{id:"轮询"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#轮询"}},[t._v("#")]),t._v(" 轮询")]),t._v(" "),s("p",[t._v("修改配置文件：")]),t._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[t._v("upstream myserver"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tserver ip"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("端口;\n    server 域名"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("端口;\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t\nserver "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    listen       "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8091")]),t._v(";\n    server_name  localhost;\n\t\n\tlocation / "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tproxy_pass http"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//myserver/;")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("这样当我访问localhost:8091的时候，会循环代理到我本机的localhost:80和support.supermap.com.cn:8090")]),t._v(" "),s("h3",{attrs:{id:"权重"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#权重"}},[t._v("#")]),t._v(" 权重")]),t._v(" "),s("p",[t._v("实现权重的方式：在配置文件中upstream块中加上weight：")]),t._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[t._v("upstream myserver"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tserver ip"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("端口 weight="),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(";\n    server 域名"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("端口 weight="),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(";\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("这样发送三次请求，有两次会转发到第二条地址，一次转发到第一条地址")]),t._v(" "),s("h3",{attrs:{id:"ip-hash"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ip-hash"}},[t._v("#")]),t._v(" IP_hash")]),t._v(" "),s("p",[t._v("实现ip_hash方式：在配置文件upstream块中加上ip_hash")]),t._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[t._v("upstream my_server"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tip_hash;\n    server ip"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("端口 weight="),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(";\n    server 域名"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("端口 weight="),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(";\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("这样一个IP会分配给固定的服务器")]),t._v(" "),s("h2",{attrs:{id:"nginx动静分离"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nginx动静分离"}},[t._v("#")]),t._v(" Nginx动静分离")]),t._v(" "),s("p",[t._v("为什么要做动静分离？")]),t._v(" "),s("p",[t._v("图")]),t._v(" "),s("blockquote",[s("p",[t._v("Nginx的并发能力公式：  worker_processes * worker_connections / 4|2 = Nginx最终的并发能力")]),t._v(" "),s("p",[t._v("动态资源需要/4，静态资源需要/2")]),t._v(" "),s("p",[t._v("Nginx通过动静分离来提升Nginx的并发能力，更快的给用户响应")])]),t._v(" "),s("h3",{attrs:{id:"动态资源代理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#动态资源代理"}},[t._v("#")]),t._v(" 动态资源代理")]),t._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[t._v("location / "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  proxy_pass 路径;\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h3",{attrs:{id:"静态资源代理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#静态资源代理"}},[t._v("#")]),t._v(" 静态资源代理")]),t._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[t._v("location / "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    root 静态资源路径;\n    index 默认访问路径下的什么资源;\n    autoindex on;#代表展示静态资源的全部内容，以列表的形式展开\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("如Nginx默认配置文件中：")]),t._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[t._v("location / "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\troot   html;\n\tindex  index.html index.htm;\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("在直接访问Nginx监听的端口号时，会代理到Nginx安装目录下的html文件夹里的index.html文件")])])}),[],!1,null,null,null);s.default=r.exports}}]);