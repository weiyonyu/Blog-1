<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Vue3 æ·±åº¦æ¢è®¨ | Notebook</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="">
    <meta name="description" content="ğŸ“æ¯å¤©è®°å½•ä¸€ç‚¹ç‚¹">
    
    <link rel="preload" href="./assets/css/0.styles.81cbcbf8.css" as="style"><link rel="preload" href="./assets/js/app.09835454.js" as="script"><link rel="preload" href="./assets/js/3.9a8cb714.js" as="script"><link rel="preload" href="./assets/js/14.2c7e4b48.js" as="script"><link rel="prefetch" href="./assets/js/10.beb9865c.js"><link rel="prefetch" href="./assets/js/11.a7dda998.js"><link rel="prefetch" href="./assets/js/12.b8ec8d23.js"><link rel="prefetch" href="./assets/js/13.481ecb00.js"><link rel="prefetch" href="./assets/js/15.47995415.js"><link rel="prefetch" href="./assets/js/16.1e2bf8c4.js"><link rel="prefetch" href="./assets/js/17.7a89769a.js"><link rel="prefetch" href="./assets/js/18.fcadf835.js"><link rel="prefetch" href="./assets/js/19.231d3618.js"><link rel="prefetch" href="./assets/js/2.33905da3.js"><link rel="prefetch" href="./assets/js/20.a85f560c.js"><link rel="prefetch" href="./assets/js/21.e075c040.js"><link rel="prefetch" href="./assets/js/22.bb17a60f.js"><link rel="prefetch" href="./assets/js/23.8188ff03.js"><link rel="prefetch" href="./assets/js/24.345a91d7.js"><link rel="prefetch" href="./assets/js/25.5b2c444b.js"><link rel="prefetch" href="./assets/js/26.2eebd931.js"><link rel="prefetch" href="./assets/js/27.f6c89798.js"><link rel="prefetch" href="./assets/js/28.58938703.js"><link rel="prefetch" href="./assets/js/29.a0b3a5cc.js"><link rel="prefetch" href="./assets/js/30.a7887201.js"><link rel="prefetch" href="./assets/js/31.cbdacff6.js"><link rel="prefetch" href="./assets/js/32.3d4caa9b.js"><link rel="prefetch" href="./assets/js/33.ba141f9f.js"><link rel="prefetch" href="./assets/js/34.7c8b3139.js"><link rel="prefetch" href="./assets/js/35.a9a3dc4c.js"><link rel="prefetch" href="./assets/js/36.1a64f97b.js"><link rel="prefetch" href="./assets/js/37.64bf3a08.js"><link rel="prefetch" href="./assets/js/38.d5a7f7a1.js"><link rel="prefetch" href="./assets/js/39.ee65b755.js"><link rel="prefetch" href="./assets/js/4.69ceb758.js"><link rel="prefetch" href="./assets/js/40.0be61706.js"><link rel="prefetch" href="./assets/js/41.af424b19.js"><link rel="prefetch" href="./assets/js/42.b47a769f.js"><link rel="prefetch" href="./assets/js/43.ed4184d6.js"><link rel="prefetch" href="./assets/js/44.8836396f.js"><link rel="prefetch" href="./assets/js/45.99c1db7a.js"><link rel="prefetch" href="./assets/js/46.2e85c6c4.js"><link rel="prefetch" href="./assets/js/47.48a5bbe5.js"><link rel="prefetch" href="./assets/js/5.2b9a4ed4.js"><link rel="prefetch" href="./assets/js/6.6f16a290.js"><link rel="prefetch" href="./assets/js/7.39aba9d0.js"><link rel="prefetch" href="./assets/js/8.abb41df8.js"><link rel="prefetch" href="./assets/js/9.92305a5c.js">
    <link rel="stylesheet" href="./assets/css/0.styles.81cbcbf8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/./" class="home-link router-link-active"><!----> <span class="site-name">Notebook</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/./dailyRecord/" class="nav-link router-link-active">
  ğŸ“šå­¦ä¹ æ€»ç»“
</a></div><div class="nav-item"><a href="/./bookmark/" class="nav-link">
  ğŸ“Œä¹¦ç­¾æ•´ç†
</a></div><div class="nav-item"><a href="/./lint/" class="nav-link">
  âœ”ï¸ç¼–ç è§„èŒƒ&amp;ååŒå¼€å‘
</a></div><div class="nav-item"><a href="http://shooterblog.site/Learn-JS-Demo/%E5%89%8D%E7%AB%AF%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1/index.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ğŸ“–çŸ¥è¯†è„‘å›¾
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/./dailyRecord/" class="nav-link router-link-active">
  ğŸ“šå­¦ä¹ æ€»ç»“
</a></div><div class="nav-item"><a href="/./bookmark/" class="nav-link">
  ğŸ“Œä¹¦ç­¾æ•´ç†
</a></div><div class="nav-item"><a href="/./lint/" class="nav-link">
  âœ”ï¸ç¼–ç è§„èŒƒ&amp;ååŒå¼€å‘
</a></div><div class="nav-item"><a href="http://shooterblog.site/Learn-JS-Demo/%E5%89%8D%E7%AB%AF%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1/index.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ğŸ“–çŸ¥è¯†è„‘å›¾
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>å‰ç«¯æ¨¡å—åŒ–å’Œæ‰“åŒ…å·¥å…·</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>å‰ç«¯å¼‚å¸¸ç›‘æ§</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Vue3åŸç†</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/./dailyRecord/VUE3Reactivity.html" class="sidebar-link">VUE3 å“åº”å¼åŸç†</a></li><li><a href="/./dailyRecord/VUE3DeepDive.html" aria-current="page" class="active sidebar-link">Vue3 æ·±åº¦æ¢è®¨</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/./dailyRecord/VUE3DeepDive.html#dom-ä¸-vdom" class="sidebar-link">DOM ä¸ VDOM</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/./dailyRecord/VUE3DeepDive.html#dom" class="sidebar-link">DOM</a></li><li class="sidebar-sub-header"><a href="/./dailyRecord/VUE3DeepDive.html#vdom" class="sidebar-link">VDOM</a></li></ul></li><li class="sidebar-sub-header"><a href="/./dailyRecord/VUE3DeepDive.html#vue-çš„ä¸‰ä¸ªæ ¸å¿ƒæ¨¡å—" class="sidebar-link">VUE çš„ä¸‰ä¸ªæ ¸å¿ƒæ¨¡å—</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/./dailyRecord/VUE3DeepDive.html#å“åº”å¼æ¨¡å—" class="sidebar-link">å“åº”å¼æ¨¡å—</a></li><li class="sidebar-sub-header"><a href="/./dailyRecord/VUE3DeepDive.html#ç¼–è¯‘å™¨æ¨¡å—" class="sidebar-link">ç¼–è¯‘å™¨æ¨¡å—</a></li><li class="sidebar-sub-header"><a href="/./dailyRecord/VUE3DeepDive.html#æ¸²æŸ“æ¨¡å—" class="sidebar-link">æ¸²æŸ“æ¨¡å—</a></li><li class="sidebar-sub-header"><a href="/./dailyRecord/VUE3DeepDive.html#ç»„ä»¶æ‰§è¡Œæ­¥éª¤çš„é¡ºåº" class="sidebar-link">ç»„ä»¶æ‰§è¡Œæ­¥éª¤çš„é¡ºåº</a></li></ul></li><li class="sidebar-sub-header"><a href="/./dailyRecord/VUE3DeepDive.html#æ¸²æŸ“æœºåˆ¶å’Œæ¸²æŸ“å‡½æ•°" class="sidebar-link">æ¸²æŸ“æœºåˆ¶å’Œæ¸²æŸ“å‡½æ•°</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/./dailyRecord/VUE3DeepDive.html#å¦‚ä½•ä½¿ç”¨-render-å‡½æ•°" class="sidebar-link">å¦‚ä½•ä½¿ç”¨ render å‡½æ•°</a></li></ul></li><li class="sidebar-sub-header"><a href="/./dailyRecord/VUE3DeepDive.html#åˆ›å»º-dom-å…ƒç´ æŒ‚è½½å¹¶æ›´æ–°" class="sidebar-link">åˆ›å»º DOM å…ƒç´ æŒ‚è½½å¹¶æ›´æ–°</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/./dailyRecord/VUE3DeepDive.html#æŒ‚è½½-mount-å‡½æ•°" class="sidebar-link">æŒ‚è½½ mount å‡½æ•°</a></li><li class="sidebar-sub-header"><a href="/./dailyRecord/VUE3DeepDive.html#æ›´æ–°-dom-èŠ‚ç‚¹" class="sidebar-link">æ›´æ–° DOM èŠ‚ç‚¹</a></li></ul></li><li class="sidebar-sub-header"><a href="/./dailyRecord/VUE3DeepDive.html#å“åº”å¼" class="sidebar-link">å“åº”å¼</a></li><li class="sidebar-sub-header"><a href="/./dailyRecord/VUE3DeepDive.html#mini-vue" class="sidebar-link">Mini VUE</a></li><li class="sidebar-sub-header"><a href="/./dailyRecord/VUE3DeepDive.html#composition-api" class="sidebar-link">composition API</a></li><li class="sidebar-sub-header"><a href="/./dailyRecord/VUE3DeepDive.html#ä»£ç ç»„ç»‡ä¸é‡ç”¨" class="sidebar-link">ä»£ç ç»„ç»‡ä¸é‡ç”¨</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue3æºç </span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>å†…åŠŸä¿®ç‚¼</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>æ€»ç»“</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>GIS</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="vue3-æ·±åº¦æ¢è®¨"><a href="#vue3-æ·±åº¦æ¢è®¨" class="header-anchor">#</a> Vue3 æ·±åº¦æ¢è®¨</h1> <h2 id="dom-ä¸-vdom"><a href="#dom-ä¸-vdom" class="header-anchor">#</a> DOM ä¸ VDOM</h2> <h3 id="dom"><a href="#dom" class="header-anchor">#</a> DOM</h3> <p>DOM(document object model) æ–‡æ¡£å¯¹è±¡æ¨¡å‹</p> <p><img src="./assets/img/DOM1.c587c8e3.png" alt="image"></p> <h3 id="vdom"><a href="#vdom" class="header-anchor">#</a> VDOM</h3> <p>VDOM(Virtual DOM) è™šæ‹ŸèŠ‚ç‚¹</p> <p>è™šæ‹ŸèŠ‚ç‚¹æ˜¯è¡¨ç¤º DOM çš„ä¸€ç§æ–¹å¼, ä½¿ç”¨ JS å¯¹è±¡</p> <p>VUE åŸºäºæ¨¡ç‰ˆåˆ›å»ºä¸€ä¸ªæ¸²æŸ“å‡½æ•°, è¿”å›è™šæ‹ŸèŠ‚ç‚¹.</p> <p><img src="./assets/img/VDOM1.6b030db1.png" alt="image"></p> <p>å½“ç»„ä»¶æ”¹å˜æ—¶, render å‡½æ•°ä¼šé‡æ–°ç”Ÿæˆ Vnode, VUE ä¼šå¯¹æ–°æ—§ node è¿›è¡Œæ¯”è¾ƒ, æœ€åæ›´æ–°åˆ°ç½‘é¡µä¸Š.</p> <p><img src="./assets/img/VDOM2.956f0fae.png" alt="image"></p> <h4 id="ä¸ºä»€ä¹ˆè¦æœ‰è™šæ‹ŸèŠ‚ç‚¹"><a href="#ä¸ºä»€ä¹ˆè¦æœ‰è™šæ‹ŸèŠ‚ç‚¹" class="header-anchor">#</a> ä¸ºä»€ä¹ˆè¦æœ‰è™šæ‹ŸèŠ‚ç‚¹</h4> <p>è™šæ‹ŸèŠ‚ç‚¹è®©ç»„ä»¶çš„æ¸²æŸ“é€»è¾‘å®Œå…¨ä»çœŸå®çš„ DOM è§£è€¦, å¹¶è®©ä»–æ›´åŠ ç›´æ¥çš„é‡æ–°ä½¿ç”¨æ¡†æ¶çš„è¿è¡Œæ—¶.</p> <p>å¦ä¸€æ–¹é¢, è™šæ‹ŸèŠ‚ç‚¹æä¾›äº†ä»¥ç¼–è¯‘æ–¹å¼æ„å»º, æ£€æŸ¥, å…‹éš†çš„èƒ½åŠ›ä»¥åŠæ“ä½œ DOM çš„ç»“æ„.</p> <h2 id="vue-çš„ä¸‰ä¸ªæ ¸å¿ƒæ¨¡å—"><a href="#vue-çš„ä¸‰ä¸ªæ ¸å¿ƒæ¨¡å—" class="header-anchor">#</a> VUE çš„ä¸‰ä¸ªæ ¸å¿ƒæ¨¡å—</h2> <h3 id="å“åº”å¼æ¨¡å—"><a href="#å“åº”å¼æ¨¡å—" class="header-anchor">#</a> å“åº”å¼æ¨¡å—</h3> <p>å“åº”å¼æ¨¡å—å…è®¸æˆ‘ä»¬åˆ›å»º JS å“åº”å¼å¯¹è±¡, å¹¶è§‚å¯Ÿå…¶å˜åŒ–. å½“é€‚ç”¨åˆ°è¿™äº›å¯¹è±¡çš„ä»£ç è¿è¡Œæ—¶, ä»–ä»¬ä¼šè¢«è·Ÿè¸ª(track). æ‰€ä»¥å½“å“åº”å¼å¯¹è±¡å‘ç”Ÿå˜åŒ–å, ä»–ä»¬å¯ä»¥å†æ¬¡è¿è¡Œ(trigger)</p> <h3 id="ç¼–è¯‘å™¨æ¨¡å—"><a href="#ç¼–è¯‘å™¨æ¨¡å—" class="header-anchor">#</a> ç¼–è¯‘å™¨æ¨¡å—</h3> <p>è·å–åˆ° HTML æ¨¡å—å¹¶å°†ä»–ä»¬ç¼–è¯‘æˆ render å‡½æ•°,ä»–å¯ä»¥åœ¨æµè§ˆå™¨è¿è¡Œæ—¶ä¸­æ‰§è¡Œ, ä½†æ›´å¸¸ç”¨åœ¨æ„å»º(build) VUE é¡¹ç›®çš„æ—¶å€™. è¿™æ ·æµè§ˆå™¨åªéœ€è¦æ¥æ”¶ render å‡½æ•°,</p> <h3 id="æ¸²æŸ“æ¨¡å—"><a href="#æ¸²æŸ“æ¨¡å—" class="header-anchor">#</a> æ¸²æŸ“æ¨¡å—</h3> <p>æ¸²æŸ“æ¨¡å—åŒ…å«åœ¨ç½‘é¡µä¸Šæ¸²æŸ“ç»„ä»¶çš„ä¸‰ä¸ªä¸åŒé˜¶æ®µ.</p> <ol><li><p>æ¸²æŸ“é˜¶æ®µ
è¿”å›ä¸€ä¸ªè™šæ‹ŸèŠ‚ç‚¹</p></li> <li><p>æŒ‚è½½é˜¶æ®µ
ä½¿ç”¨è™šæ‹ŸèŠ‚ç‚¹, å¹¶è°ƒç”¨ DOM API åˆ›å»ºé¡µé¢</p></li> <li><p>è¡¥ä¸é˜¶æ®µ
å°†æ—§çš„è™šæ‹ŸèŠ‚ç‚¹å’Œæ–°çš„è™šæ‹ŸèŠ‚ç‚¹åšå¯¹æ¯”, æ›´æ–°å‘ç”Ÿå˜åŒ–çš„éƒ¨åˆ†</p></li></ol> <p><img src="./assets/img/4.ecd697fc.png" alt="image"></p> <h3 id="ç»„ä»¶æ‰§è¡Œæ­¥éª¤çš„é¡ºåº"><a href="#ç»„ä»¶æ‰§è¡Œæ­¥éª¤çš„é¡ºåº" class="header-anchor">#</a> ç»„ä»¶æ‰§è¡Œæ­¥éª¤çš„é¡ºåº</h3> <ol><li><p>æ‹¥æœ‰ä¸€ä¸ªæ¨¡ç‰ˆä»¥åŠåœ¨æ¨¡ç‰ˆå†…çš„å“åº”å¼å¯¹è±¡</p></li> <li><p>æ¨¡ç‰ˆç¼–è¯‘å™¨å°† HTML ç¼–è¯‘ä¸º render å‡½æ•°</p></li> <li><p>ä½¿ç”¨å“åº”å¼æ¨¡å—åˆå§‹åŒ–å“åº”å¼å¯¹è±¡</p></li> <li><p>æ¸²æŸ“æ¨¡å—è°ƒç”¨ render å‡½æ•°, render å‡½æ•°åˆä¼šå¼•ç”¨è·Ÿè¸ªå“åº”å¼å¯¹è±¡(track), æœ€å render å‡½æ•°è¿”å›è™šæ‹ŸèŠ‚ç‚¹</p></li> <li><p>åœ¨æŒ‚è½½é˜¶æ®µ, ä½¿ç”¨è™šæ‹ŸèŠ‚ç‚¹åˆ›å»º web é¡µé¢</p></li> <li><p>å“åº”å¼å¯¹è±¡å‘ç”Ÿä»»ä½•å˜åŒ–, å“åº”å¼è¢«è§¦å‘(trigger), æ¸²æŸ“æ¨¡å—ä¼šå†æ¬¡æ‰§è¡Œ render åˆ›å»ºä¸€ä¸ªæ–°çš„è™šæ‹ŸèŠ‚ç‚¹, å¯¹æ¯”æ–°æ—§è™šæ‹ŸèŠ‚ç‚¹, å‘é€åˆ°è¡¥ä¸å‡½æ•°</p></li> <li><p>è¡¥ä¸å‡½æ•°æ ¹æ®å˜åŒ–æ›´æ–°é¡µé¢</p></li></ol> <h2 id="æ¸²æŸ“æœºåˆ¶å’Œæ¸²æŸ“å‡½æ•°"><a href="#æ¸²æŸ“æœºåˆ¶å’Œæ¸²æŸ“å‡½æ•°" class="header-anchor">#</a> æ¸²æŸ“æœºåˆ¶å’Œæ¸²æŸ“å‡½æ•°</h2> <p>åœ¨ VUE3 ä¸­ render å‡½æ•°çš„å†™æ³•ä¸ VUE2 æœ‰æ‰€å˜åŒ–, æ‰å¹³çš„ props å‚æ•°ä»¥åŠ hyperscript ä» Vue æœ¬èº«å…¨å±€å¯¼å…¥</p> <h3 id="å¦‚ä½•ä½¿ç”¨-render-å‡½æ•°"><a href="#å¦‚ä½•ä½¿ç”¨-render-å‡½æ•°" class="header-anchor">#</a> å¦‚ä½•ä½¿ç”¨ render å‡½æ•°</h3> <p>æˆ‘ä»¬å¯ä»¥åœ¨ VUE ç»„ä»¶ä¸­ç”¨ render å‡½æ•°æ›¿ä»£ template</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> h <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> App <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&quot;hello&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token function">h</span><span class="token punctuation">(</span><span class="token string">&quot;span&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;world&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// &lt;div id=&quot;hello&quot;&gt;&lt;span&gt;world&lt;/span&gt;&lt;/div&gt;</span>
</code></pre></div><h4 id="æ¡ä»¶åˆ¤æ–­"><a href="#æ¡ä»¶åˆ¤æ–­" class="header-anchor">#</a> æ¡ä»¶åˆ¤æ–­</h4> <p>ä½¿ç”¨ä¸‰å…ƒè¡¨è¾¾å¼è¿›è¡Œåˆ¤æ–­</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> h <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>

<span class="token keyword">const</span> App <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">render</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ok
      <span class="token operator">?</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span><span class="token punctuation">{</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">'hello'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">,</span> <span class="token string">'world'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
      <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>otherCondition
        <span class="token operator">?</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">,</span> <span class="token string">'other branch'</span><span class="token punctuation">)</span>
        <span class="token operator">:</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ä½¿ç”¨å˜é‡è¿›è¡Œåˆ¤æ–­</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> h <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>

<span class="token keyword">const</span> App <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">render</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> nodeToReturn
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>ok<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        nodeToReturn <span class="token operator">=</span> <span class="token operator">...</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>xxx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="å¾ªç¯"><a href="#å¾ªç¯" class="header-anchor">#</a> å¾ªç¯</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> h <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">const</span> App <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">render</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>list<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">key</span><span class="token operator">:</span> item<span class="token punctuation">.</span>id<span class="token punctuation">}</span><span class="token punctuation">,</span> item<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="æ’æ§½"><a href="#æ’æ§½" class="header-anchor">#</a> æ’æ§½</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> h <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> App <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//  Vue 3 é‡Œé»˜è®¤æ’æ§½å°†æš´éœ²åœ¨this.$slot.default</span>
    <span class="token keyword">const</span> slot <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$slot<span class="token punctuation">.</span>default
      <span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$slot<span class="token punctuation">.</span><span class="token function">default</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// å¦‚æœå­˜åœ¨, slotæ˜¯æ•°ç»„</span>
      <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token comment">// return h('div', slot)</span>

    <span class="token comment">// renderå‡½æ•°éå¸¸çµæ´», å¯ä»¥ç”¨filterè¿‡æ»¤ï¼Œä¹Ÿå¯ä»¥ç”¨mapéå†å®ƒ</span>
    <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span>
      <span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span>
      slot<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">vnode</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>vnode<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="æ¡ˆä¾‹"><a href="#æ¡ˆä¾‹" class="header-anchor">#</a> æ¡ˆä¾‹</h4> <p>å¾ªç¯åµŒå¥—åˆ—è¡¨, æ™®é€šçš„åŸºäºæ¨¡æ¿çš„è¯­æ³•ï¼Œåœ¨åŒä¸€ä¸ªæ’æ§½å†…å®ƒä»¬éƒ½æ˜¯é»˜è®¤æ’æ§½ï¼Œä½ èƒ½åšçš„åªæœ‰æ¸²æŸ“è¿™ä¸ªéƒ¨åˆ†ï¼Œå› æ­¤è¿™åœ¨æ¨¡æ¿å¾ˆéš¾å®ç°ã€‚ä½†æ˜¯ç”¨æ¸²æŸ“å‡½æ•°åˆ™èƒ½å¤Ÿç¨‹åºåŒ–åœ°éå†æ’æ§½å†…çš„æ¯ä¸ªé¡¹ç›®ï¼Œç„¶åæŠŠå®ƒä»¬å˜æˆåˆ«çš„ä¸œè¥¿ã€‚</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://unpkg.com/vue@next<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
  <span class="token selector">.mt-4</span> <span class="token punctuation">{</span>
    <span class="token property">margin</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>app<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">const</span> <span class="token punctuation">{</span> h<span class="token punctuation">,</span> createApp <span class="token punctuation">}</span> <span class="token operator">=</span> Vue<span class="token punctuation">;</span>
  <span class="token keyword">const</span> Stack <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> slot <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$slots<span class="token punctuation">.</span>default <span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$slots<span class="token punctuation">.</span><span class="token function">default</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span>
        <span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> <span class="token keyword">class</span><span class="token operator">:</span> <span class="token string">&quot;stack&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        slot<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">child</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token keyword">class</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">mt-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>$attrs<span class="token punctuation">.</span>size<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>child<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> App <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">components</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      Stack<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
      &lt;Stack size=&quot;4&quot;&gt;
        &lt;div&gt;hello&lt;/div&gt;
        &lt;Stack size=&quot;4&quot;&gt;
          &lt;div&gt;hello&lt;/div&gt;
          &lt;div&gt;hello&lt;/div&gt;
        &lt;/Stack&gt;
      &lt;/Stack&gt;
    </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token function">createApp</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token string">&quot;#app&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>æ•ˆæœå¦‚ä¸‹</p> <p><img src="./assets/img/5.1ac762eb.png" alt="image"></p> <p>å½“åˆ›ä½œè¿™äº›ç»„ä»¶çš„æ—¶å€™, æœ‰æ—¶ render å‡½æ•°ä¼šæ¯”å†™æ¨¡ç‰ˆæ–¹ä¾¿å¾ˆå¤š. æ‰€ä»¥æˆ‘ä»¬è¦äº†è§£ä¸¤ç§æ–¹æ³•çš„åˆ©å¼Š, ç¼–å†™ä»£ç çš„æ—¶å€™é€‰æ‹©æœ€ä½³è§£å†³æ–¹æ¡ˆ.</p> <h2 id="åˆ›å»º-dom-å…ƒç´ æŒ‚è½½å¹¶æ›´æ–°"><a href="#åˆ›å»º-dom-å…ƒç´ æŒ‚è½½å¹¶æ›´æ–°" class="header-anchor">#</a> åˆ›å»º DOM å…ƒç´ æŒ‚è½½å¹¶æ›´æ–°</h2> <h3 id="æŒ‚è½½-mount-å‡½æ•°"><a href="#æŒ‚è½½-mount-å‡½æ•°" class="header-anchor">#</a> æŒ‚è½½ mount å‡½æ•°</h3> <p>å¯¹äºè¦æ„å»ºçš„åº”ç”¨ç¨‹åº, æŒ‚è½½å°±æ˜¯æ ¹æ®è™šæ‹ŸèŠ‚ç‚¹åˆ›å»ºçœŸå®çš„å…ƒç´ </p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token parameter">tag<span class="token punctuation">,</span> props<span class="token punctuation">,</span> children</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    tag<span class="token punctuation">,</span>
    props<span class="token punctuation">,</span>
    children<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">mount</span><span class="token punctuation">(</span><span class="token parameter">vnode<span class="token punctuation">,</span> container</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// æ ¹æ®è™šæ‹ŸèŠ‚ç‚¹çš„tagåˆ›å»ºçœŸå®å…ƒç´ </span>
  <span class="token keyword">const</span> el <span class="token operator">=</span> <span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>el <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>tag<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> vnode<span class="token punctuation">.</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// keyå¯èƒ½æ˜¯property, attribute, æˆ–è€…äº‹ä»¶ç›‘å¬</span>
      <span class="token comment">// ç®€å•èµ·è§, ä¸åšåˆ¤æ–­, é»˜è®¤attribute</span>
      <span class="token keyword">const</span> value <span class="token operator">=</span> vnode<span class="token punctuation">.</span>props<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
      el<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>children<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// childå¯ä»¥æ˜¯å­—ç¬¦ä¸², ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªvnode</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> vnode<span class="token punctuation">.</span>children <span class="token operator">===</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      el<span class="token punctuation">.</span>textContent <span class="token operator">=</span> vnode<span class="token punctuation">.</span>children<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      vnode<span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">child</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">mount</span><span class="token punctuation">(</span>child<span class="token punctuation">,</span> el<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// æŒ‚è½½åˆ°å®¹å™¨ä¸‹</span>
  container<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// å®šä¹‰ä¸€ä¸ªè™šæ‹ŸèŠ‚ç‚¹</span>
<span class="token keyword">const</span> vdom <span class="token operator">=</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token keyword">class</span><span class="token operator">:</span> <span class="token string">&quot;red&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token function">h</span><span class="token punctuation">(</span><span class="token string">&quot;span&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// æŒ‚è½½è™šæ‹ŸèŠ‚ç‚¹</span>
<span class="token function">mount</span><span class="token punctuation">(</span>vdom<span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;app&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="æ›´æ–°-dom-èŠ‚ç‚¹"><a href="#æ›´æ–°-dom-èŠ‚ç‚¹" class="header-anchor">#</a> æ›´æ–° DOM èŠ‚ç‚¹</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">patch</span><span class="token punctuation">(</span><span class="token parameter">oldVnode<span class="token punctuation">,</span> newVnode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>oldVnode<span class="token punctuation">.</span>tag <span class="token operator">===</span> newVnode<span class="token punctuation">.</span>tag<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> el <span class="token operator">=</span> <span class="token punctuation">(</span>newVnode<span class="token punctuation">.</span>el <span class="token operator">=</span> oldVnode<span class="token punctuation">.</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> oldProps <span class="token operator">=</span> oldVnode<span class="token punctuation">.</span>props <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> newProps <span class="token operator">=</span> newVnode<span class="token punctuation">.</span>props <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> newProps<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> oldValue <span class="token operator">=</span> oldVnode<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> newValue <span class="token operator">=</span> newProps<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>oldValue <span class="token operator">!==</span> newValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ç®€å•èµ·è§, ä¸åšåˆ¤æ–­, é»˜è®¤attribute</span>
        el<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> newValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// å»æ‰å¤±æ•ˆçš„props</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> oldProps<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>key <span class="token keyword">in</span> newProps<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        el<span class="token punctuation">.</span><span class="token function">removeAttribute</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// å¤„ç†children</span>
    <span class="token keyword">const</span> oldChildren <span class="token operator">=</span> oldVnode<span class="token punctuation">.</span>children<span class="token punctuation">;</span>
    <span class="token keyword">const</span> newChildren <span class="token operator">=</span> newVnode<span class="token punctuation">.</span>children<span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> newChildren <span class="token operator">===</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> oldChildren <span class="token operator">===</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>newChildren <span class="token operator">!==</span> oldChildren<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          el<span class="token punctuation">.</span>textContent <span class="token operator">=</span> newChildren<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        el<span class="token punctuation">.</span>textContent <span class="token operator">=</span> newChildren<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> oldChildren <span class="token operator">===</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// æ¸…ç©ºå…ƒç´ </span>
        el<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
        newChildren<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">child</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token function">mount</span><span class="token punctuation">(</span>child<span class="token punctuation">,</span> el<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> commonLength <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>oldChildren<span class="token punctuation">.</span>length<span class="token punctuation">,</span> newChildren<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> commonLength<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">patch</span><span class="token punctuation">(</span>oldChildren<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> newChildren<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>newChildren<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> oldChildren<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          newChildren<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>oldChildren<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">child</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">mount</span><span class="token punctuation">(</span>child<span class="token punctuation">,</span> el<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          oldChildren<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>newChildren<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">child</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            el<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>child<span class="token punctuation">.</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// æ›¿æ¢å…ƒç´ </span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> vdom2 <span class="token operator">=</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token keyword">class</span><span class="token operator">:</span> <span class="token string">&quot;green&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token function">h</span><span class="token punctuation">(</span><span class="token string">&quot;span&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">&quot;change!!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">patch</span><span class="token punctuation">(</span>vdom<span class="token punctuation">,</span> vdom2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="å“åº”å¼"><a href="#å“åº”å¼" class="header-anchor">#</a> å“åº”å¼</h2> <p>å…³äºå“åº”å¼, åœ¨å¦ä¸€ç¯‡ä¸­æœ‰è¯¦ç»†çš„ä»‹ç». è¿™é‡Œå°±ä¸åœ¨èµ˜è¿°.</p> <h2 id="mini-vue"><a href="#mini-vue" class="header-anchor">#</a> Mini VUE</h2> <p>æˆ‘ä»¬å·²ç»å®ç°äº†è™šæ‹ŸèŠ‚ç‚¹ä»¥åŠæ›´æ–° DOM çš„é€»è¾‘, åˆå®ç°äº†å±æ€§å“åº”å¼, é‚£ä¹ˆä¸€ä¸ªç®€å•çš„ VUE å°±å¯ä»¥é€šè¿‡è¿™å‡ ä¸ªæ¨¡å—ç»„è£…å®ç°äº†</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> App <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span>
      <span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token function-variable function">onclick</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>count<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function">String</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>count<span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">mountApp</span><span class="token punctuation">(</span><span class="token parameter">component<span class="token punctuation">,</span> container</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> isMounted <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> prevVdom <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token function">watchEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isMounted<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> vdom <span class="token operator">=</span> component<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">mount</span><span class="token punctuation">(</span>vdom<span class="token punctuation">,</span> container<span class="token punctuation">)</span><span class="token punctuation">;</span>
      prevVdom <span class="token operator">=</span> vdom<span class="token punctuation">;</span>
      isMounted <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> newVdom <span class="token operator">=</span> component<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">patch</span><span class="token punctuation">(</span>prevVdom<span class="token punctuation">,</span> newVdom<span class="token punctuation">)</span><span class="token punctuation">;</span>
      prevVdom <span class="token operator">=</span> newVdom<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">mountApp</span><span class="token punctuation">(</span>App<span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;app&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="composition-api"><a href="#composition-api" class="header-anchor">#</a> composition API</h2> <p>ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨ composition API çš„ä¾‹å­</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> reactive<span class="token punctuation">,</span> ref<span class="token punctuation">,</span> computed<span class="token punctuation">,</span> watchEffect<span class="token punctuation">,</span> watch<span class="token punctuation">,</span> onMounted <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// æŠ½ç¦»é‡ç”¨é€»è¾‘åœ¨ä¸åŒç»„ä»¶ä¸‹ä½¿ç”¨</span>
<span class="token keyword">function</span> <span class="token function">useFeature</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">onMounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;mounted!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> fetchData <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">watchEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// ç›‘å¬propsçš„å±æ€§</span>
      <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">url</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>props<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        fetchData<span class="token punctuation">.</span>value <span class="token operator">=</span> res<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">watch</span><span class="token punctuation">(</span>
      <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        state<span class="token punctuation">.</span>count<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">(</span><span class="token parameter">count<span class="token punctuation">,</span> oldCount</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// åŒºåˆ«äºwatchEffect, ä¸ä¼šé©¬ä¸Šæ‰§è¡Œå›è°ƒ, å¹¶ä¸”anotherPropertyä¸ä¼šè¢«å“åº”å¼ç›‘å¬</span>
        state<span class="token punctuation">.</span>anotherProperty <span class="token operator">=</span> count<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> plusOne <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      state<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// watchç›‘å¬çš„å¿…é¡»æ˜¯å“åº”å¼å¯¹è±¡</span>
    <span class="token function">watch</span><span class="token punctuation">(</span><span class="token punctuation">[</span>count<span class="token punctuation">,</span> plusOne<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">count<span class="token punctuation">,</span> oldCount</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// åŒºåˆ«äºwatchEffect, anotherPropertyä¸ä¼šè¢«å“åº”å¼ç›‘å¬</span>
      state<span class="token punctuation">.</span>anotherProperty <span class="token operator">=</span> count<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// onMounted(() =&gt; {</span>
    <span class="token comment">//   console.log(&quot;mounted!&quot;);</span>
    <span class="token comment">// });</span>
    <span class="token function">useFeature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      state<span class="token punctuation">,</span>
      <span class="token function-variable function">increment</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        state<span class="token punctuation">.</span>count<span class="token operator">++</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>æ‰€æœ‰çš„ composition API éƒ½åœ¨ä¸€ä¸ªåä¸º setup çš„é’©å­ä¸­å‘ç”Ÿ. å¼•å…¥ä¸€ä¸ªæ–°çš„ setup é’©å­ç›®çš„æ˜¯å¯ä»¥ç»“åˆ VUE2 ç°æœ‰çš„ options API, ä¸¤è€…å¹¶è‚©å·¥ä½œä¸å†²çª. å¹¶ä¸”åœ¨ setup é’©å­ return çš„æ‰€æœ‰å†…å®¹å°†ä¼šæš´éœ²åœ¨æ¨¡ç‰ˆä¸­, ä»¥åŠç»„ä»¶çš„ this å¯¹è±¡ä¸­ä¾› options API ä½¿ç”¨.</p> <p>setup ä½œä¸ºé’©å­å‡½æ•°, å°†ä¼šåœ¨ vue ç”Ÿå‘½å‘¨æœŸæœ€å¼€å§‹è°ƒç”¨, ç”šè‡³åœ¨ beforeCreate ä¹‹å‰. éœ€è¦æ³¨æ„çš„æ˜¯åœ¨ setup æˆ‘ä»¬æ²¡æœ‰æƒé™è®¿é—® this, è¿™æ˜¯ VUE3 æ•…æ„è€Œä¸º.</p> <p>å› ä¸º setup å¯ä»¥ä½¿ç”¨ä¸°å¯Œçš„ composition API , å¦å¤– setup æ˜¯åœ¨æ‰€æœ‰ options API ä¹‹å‰è¢«è§¦å‘, æˆ‘ä»¬ä¹Ÿä¸èƒ½åœ¨ setup ä¸­ä½¿ç”¨ data æˆ–è€…æ˜¯ computed, æ‰€ä»¥åœ¨ setup æœ¬èº«å¹¶æ²¡æœ‰å¤ªå¤šçš„ this ç”¨ä¾‹.</p> <p>æ‰€ä»¥, ä¸€èˆ¬çš„ç»éªŒæ³•åˆ™æ˜¯åœ¨ setup å†…éƒ¨, æˆ‘ä»¬ä¸ä¼šå‡è®¾æˆ‘ä»¬å·²ç»çŸ¥é“å…¶ä»– options çš„å†…å®¹.</p> <h2 id="ä»£ç ç»„ç»‡ä¸é‡ç”¨"><a href="#ä»£ç ç»„ç»‡ä¸é‡ç”¨" class="header-anchor">#</a> ä»£ç ç»„ç»‡ä¸é‡ç”¨</h2> <p>å‡è®¾æˆ‘ä»¬çš„ç»„ä»¶æœ‰ä¸‰ä¸ªä¸»è¦åŠŸèƒ½ A,B,C åŠŸèƒ½</p> <p>å¦‚æœæ˜¯ä½¿ç”¨ options API, æˆ‘ä»¬å¾ˆå®¹æ˜“çŸ¥é“ç»„ä»¶å†…çš„æ‰€æœ‰ data, æ‰€æœ‰ methods, ä½†æ˜¯å…·ä½“åˆ°æ¯ä¸ªåŠŸèƒ½çœŸæ­£éœ€è¦çš„ data,methods çš„æ—¶å€™, æƒ…å†µå°±å˜å¤æ‚äº†</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">foo</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// åŠŸèƒ½A</span>
      <span class="token literal-property property">bar</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token comment">// åŠŸèƒ½B</span>
      <span class="token literal-property property">baz</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token comment">// åŠŸèƒ½C</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">one</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// åŠŸèƒ½A</span>
    <span class="token function">two</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// åŠŸèƒ½B</span>
    <span class="token function">three</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// åŠŸèƒ½C</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">watch</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">computed</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>è¿™æ—¶ä½¿ç”¨ composition API å°†è§£å†³ä¸Šé¢çš„é—®é¢˜</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> reactive<span class="token punctuation">,</span> ref<span class="token punctuation">,</span> computed<span class="token punctuation">,</span> watchEffect<span class="token punctuation">,</span> watch<span class="token punctuation">,</span> onMounted <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// æŠ½ç¦»é‡ç”¨é€»è¾‘åœ¨ä¸åŒç»„ä»¶ä¸‹ä½¿ç”¨</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">useFeatureA</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> foo <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> plusOne <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    foo<span class="token punctuation">.</span>value <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">watchEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">functionA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    foo<span class="token punctuation">,</span>
    plusOne
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// ç”šè‡³æ˜¯å¯¼å‡ºsetupç»™åˆ«çš„ç»„ä»¶å¯¹è¯¥ç»„ä»¶è¿›è¡Œæ‰©å±•</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">setup</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">// åŠŸèƒ½A</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span>foo<span class="token punctuation">,</span> plusOne <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useFeatureA</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token comment">// åŠŸèƒ½B</span>
  <span class="token comment">// ...</span>

  <span class="token comment">// åŠŸèƒ½C</span>
  <span class="token comment">// ...</span>

  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token comment">// setup(props) {</span>
  <span class="token comment">//   // åŠŸèƒ½A</span>
  <span class="token comment">//   const {foo, plusOne } = useFeatureA()</span>

  <span class="token comment">//   // åŠŸèƒ½B</span>
  <span class="token comment">//   // ...</span>

  <span class="token comment">//   // åŠŸèƒ½C</span>
  <span class="token comment">//   // ...</span>

  <span class="token comment">//   return {</span>
  <span class="token comment">//     // ...</span>
  <span class="token comment">//   };</span>
  <span class="token comment">// },</span>
  setup
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>å¯ä»¥çœ‹åˆ°åœ¨ä»£ç é‡ç”¨æ–¹é¢, ä½¿ç”¨ composition API å¯ä»¥é¿å…ä½¿ç”¨ mixins</p> <p>è¡¥å…… mixins çš„ç¼ºç‚¹:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> createApp <span class="token punctuation">}</span> <span class="token operator">=</span> Vue<span class="token punctuation">;</span>

<span class="token keyword">const</span> mouseMixin <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;mousemove&quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>update<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">update</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>x <span class="token operator">=</span> e<span class="token punctuation">.</span>pageX<span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">=</span> e<span class="token punctuation">.</span>pageY<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">unmounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    window<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;mousemove&quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>update<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> anotherMixin <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ä¸åŒçš„mixinä¹‹é—´ å±æ€§çš„å‘½åä¼šæœ‰å†²çªçš„å¯èƒ½</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> App <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">{{x}} {{y}}</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
  <span class="token comment">// å‡ºç°å¤šä¸ªmixinçš„æ—¶å€™, å±æ€§æ¥è‡ªå“ªä¸ªmixinå°†ä¸å¾—è€ŒçŸ¥</span>
  <span class="token literal-property property">mixins</span><span class="token operator">:</span> <span class="token punctuation">[</span>mouseMixin<span class="token punctuation">,</span> anotherMixin<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token function">createApp</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token string">&quot;#app&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">11/19/2021, 2:13:57 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/./dailyRecord/VUE3Reactivity.html" class="prev">
        VUE3 å“åº”å¼åŸç†
      </a></span> <span class="next"><a href="/./dailyRecord/VUE3-reactivity-core.html">
        ä¸€ã€å“åº”å¼æ ¸å¿ƒ(ä¾èµ–æ”¶é›†å’Œè§¦å‘)
      </a>
      â†’
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="./assets/js/app.09835454.js" defer></script><script src="./assets/js/3.9a8cb714.js" defer></script><script src="./assets/js/14.2c7e4b48.js" defer></script>
  </body>
</html>
