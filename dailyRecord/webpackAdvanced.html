<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Webpack æ‰“åŒ…åˆ†æä»¥åŠloaderç¼–å†™ | Notebook</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="">
    <meta name="description" content="ğŸ“æ¯å¤©è®°å½•ä¸€ç‚¹ç‚¹">
    
    <link rel="preload" href="./assets/css/0.styles.81cbcbf8.css" as="style"><link rel="preload" href="./assets/js/app.09835454.js" as="script"><link rel="preload" href="./assets/js/3.9a8cb714.js" as="script"><link rel="preload" href="./assets/js/7.39aba9d0.js" as="script"><link rel="prefetch" href="./assets/js/10.beb9865c.js"><link rel="prefetch" href="./assets/js/11.a7dda998.js"><link rel="prefetch" href="./assets/js/12.b8ec8d23.js"><link rel="prefetch" href="./assets/js/13.481ecb00.js"><link rel="prefetch" href="./assets/js/14.2c7e4b48.js"><link rel="prefetch" href="./assets/js/15.47995415.js"><link rel="prefetch" href="./assets/js/16.1e2bf8c4.js"><link rel="prefetch" href="./assets/js/17.7a89769a.js"><link rel="prefetch" href="./assets/js/18.fcadf835.js"><link rel="prefetch" href="./assets/js/19.231d3618.js"><link rel="prefetch" href="./assets/js/2.33905da3.js"><link rel="prefetch" href="./assets/js/20.a85f560c.js"><link rel="prefetch" href="./assets/js/21.e075c040.js"><link rel="prefetch" href="./assets/js/22.bb17a60f.js"><link rel="prefetch" href="./assets/js/23.8188ff03.js"><link rel="prefetch" href="./assets/js/24.345a91d7.js"><link rel="prefetch" href="./assets/js/25.5b2c444b.js"><link rel="prefetch" href="./assets/js/26.2eebd931.js"><link rel="prefetch" href="./assets/js/27.f6c89798.js"><link rel="prefetch" href="./assets/js/28.58938703.js"><link rel="prefetch" href="./assets/js/29.a0b3a5cc.js"><link rel="prefetch" href="./assets/js/30.a7887201.js"><link rel="prefetch" href="./assets/js/31.cbdacff6.js"><link rel="prefetch" href="./assets/js/32.3d4caa9b.js"><link rel="prefetch" href="./assets/js/33.ba141f9f.js"><link rel="prefetch" href="./assets/js/34.7c8b3139.js"><link rel="prefetch" href="./assets/js/35.a9a3dc4c.js"><link rel="prefetch" href="./assets/js/36.1a64f97b.js"><link rel="prefetch" href="./assets/js/37.64bf3a08.js"><link rel="prefetch" href="./assets/js/38.d5a7f7a1.js"><link rel="prefetch" href="./assets/js/39.ee65b755.js"><link rel="prefetch" href="./assets/js/4.69ceb758.js"><link rel="prefetch" href="./assets/js/40.0be61706.js"><link rel="prefetch" href="./assets/js/41.af424b19.js"><link rel="prefetch" href="./assets/js/42.b47a769f.js"><link rel="prefetch" href="./assets/js/43.ed4184d6.js"><link rel="prefetch" href="./assets/js/44.8836396f.js"><link rel="prefetch" href="./assets/js/45.99c1db7a.js"><link rel="prefetch" href="./assets/js/46.2e85c6c4.js"><link rel="prefetch" href="./assets/js/47.48a5bbe5.js"><link rel="prefetch" href="./assets/js/5.2b9a4ed4.js"><link rel="prefetch" href="./assets/js/6.6f16a290.js"><link rel="prefetch" href="./assets/js/8.abb41df8.js"><link rel="prefetch" href="./assets/js/9.92305a5c.js">
    <link rel="stylesheet" href="./assets/css/0.styles.81cbcbf8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/./" class="home-link router-link-active"><!----> <span class="site-name">Notebook</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/./dailyRecord/" class="nav-link router-link-active">
  ğŸ“šå­¦ä¹ æ€»ç»“
</a></div><div class="nav-item"><a href="/./bookmark/" class="nav-link">
  ğŸ“Œä¹¦ç­¾æ•´ç†
</a></div><div class="nav-item"><a href="/./lint/" class="nav-link">
  âœ”ï¸ç¼–ç è§„èŒƒ&amp;ååŒå¼€å‘
</a></div><div class="nav-item"><a href="http://shooterblog.site/Learn-JS-Demo/%E5%89%8D%E7%AB%AF%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1/index.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ğŸ“–çŸ¥è¯†è„‘å›¾
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/./dailyRecord/" class="nav-link router-link-active">
  ğŸ“šå­¦ä¹ æ€»ç»“
</a></div><div class="nav-item"><a href="/./bookmark/" class="nav-link">
  ğŸ“Œä¹¦ç­¾æ•´ç†
</a></div><div class="nav-item"><a href="/./lint/" class="nav-link">
  âœ”ï¸ç¼–ç è§„èŒƒ&amp;ååŒå¼€å‘
</a></div><div class="nav-item"><a href="http://shooterblog.site/Learn-JS-Demo/%E5%89%8D%E7%AB%AF%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1/index.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ğŸ“–çŸ¥è¯†è„‘å›¾
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>å‰ç«¯æ¨¡å—åŒ–å’Œæ‰“åŒ…å·¥å…·</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/./dailyRecord/qdmkh.html" class="sidebar-link">å‰ç«¯æ¨¡å—åŒ–çš„å‘å±•</a></li><li><a href="/./dailyRecord/webpack.html" class="sidebar-link">webpack</a></li><li><a href="/./dailyRecord/webpackAdvanced.html" aria-current="page" class="active sidebar-link">Webpack æ‰“åŒ…åˆ†æä»¥åŠloaderç¼–å†™</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/./dailyRecord/webpackAdvanced.html#æ‰“åŒ…æ–‡ä»¶åˆ†æ-webpack4" class="sidebar-link">æ‰“åŒ…æ–‡ä»¶åˆ†æï¼ˆwebpack4ï¼‰</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/./dailyRecord/webpackAdvanced.html#webpack-æ‰“åŒ…æµç¨‹å›¾" class="sidebar-link">webpack æ‰“åŒ…æµç¨‹å›¾</a></li><li class="sidebar-sub-header"><a href="/./dailyRecord/webpackAdvanced.html#åŒæ­¥ä»£ç æ‰“åŒ…æ–‡ä»¶åˆ†æ" class="sidebar-link">åŒæ­¥ä»£ç æ‰“åŒ…æ–‡ä»¶åˆ†æ</a></li><li class="sidebar-sub-header"><a href="/./dailyRecord/webpackAdvanced.html#æ‡’åŠ è½½-å¼‚æ­¥ä»£ç -æ‰“åŒ…æ–‡ä»¶åˆ†æ" class="sidebar-link">æ‡’åŠ è½½ï¼ˆå¼‚æ­¥ä»£ç ï¼‰æ‰“åŒ…æ–‡ä»¶åˆ†æ</a></li><li class="sidebar-sub-header"><a href="/./dailyRecord/webpackAdvanced.html#æ‰“åŒ…æ–‡ä»¶åŠ è½½æµç¨‹åˆ†æå›¾" class="sidebar-link">æ‰“åŒ…æ–‡ä»¶åŠ è½½æµç¨‹åˆ†æå›¾</a></li></ul></li><li class="sidebar-sub-header"><a href="/./dailyRecord/webpackAdvanced.html#ç¼–å†™-loader-çš„å‰ç½®çŸ¥è¯†" class="sidebar-link">ç¼–å†™ Loader çš„å‰ç½®çŸ¥è¯†</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/./dailyRecord/webpackAdvanced.html#loader-å¤„ç†æ¨¡å—æµç¨‹" class="sidebar-link">loader å¤„ç†æ¨¡å—æµç¨‹</a></li><li class="sidebar-sub-header"><a href="/./dailyRecord/webpackAdvanced.html#loader-çš„èŒè´£" class="sidebar-link">loader çš„èŒè´£</a></li><li class="sidebar-sub-header"><a href="/./dailyRecord/webpackAdvanced.html#loader-åŸºç¡€" class="sidebar-link">Loader åŸºç¡€</a></li><li class="sidebar-sub-header"><a href="/./dailyRecord/webpackAdvanced.html#åŠ è½½è°ƒè¯•æœ¬åœ°-loader" class="sidebar-link">åŠ è½½è°ƒè¯•æœ¬åœ° Loader</a></li><li class="sidebar-sub-header"><a href="/./dailyRecord/webpackAdvanced.html#loader-å·¥å…·åº“" class="sidebar-link">loader å·¥å…·åº“</a></li><li class="sidebar-sub-header"><a href="/./dailyRecord/webpackAdvanced.html#è¿”å›å…¶å®ƒç»“æœ" class="sidebar-link">è¿”å›å…¶å®ƒç»“æœ</a></li><li class="sidebar-sub-header"><a href="/./dailyRecord/webpackAdvanced.html#åŒæ­¥ä¸å¼‚æ­¥" class="sidebar-link">åŒæ­¥ä¸å¼‚æ­¥</a></li><li class="sidebar-sub-header"><a href="/./dailyRecord/webpackAdvanced.html#å¤„ç†äºŒè¿›åˆ¶æ•°æ®" class="sidebar-link">å¤„ç†äºŒè¿›åˆ¶æ•°æ®</a></li><li class="sidebar-sub-header"><a href="/./dailyRecord/webpackAdvanced.html#loader-ä¾èµ–" class="sidebar-link">loader ä¾èµ–</a></li><li class="sidebar-sub-header"><a href="/./dailyRecord/webpackAdvanced.html#loader-ç¼“å­˜åŠ é€Ÿ" class="sidebar-link">loader ç¼“å­˜åŠ é€Ÿ</a></li><li class="sidebar-sub-header"><a href="/./dailyRecord/webpackAdvanced.html#æ¨¡å—ä¾èµ–" class="sidebar-link">æ¨¡å—ä¾èµ–</a></li><li class="sidebar-sub-header"><a href="/./dailyRecord/webpackAdvanced.html#loaderçš„æ‰§è¡Œé¡ºåº" class="sidebar-link">loaderçš„æ‰§è¡Œé¡ºåº</a></li><li class="sidebar-sub-header"><a href="/./dailyRecord/webpackAdvanced.html#loader-picthæ–¹æ³•" class="sidebar-link">loader picthæ–¹æ³•</a></li><li class="sidebar-sub-header"><a href="/./dailyRecord/webpackAdvanced.html#astè¯­æ³•æ ‘" class="sidebar-link">ASTè¯­æ³•æ ‘</a></li></ul></li><li class="sidebar-sub-header"><a href="/./dailyRecord/webpackAdvanced.html#loader-ç¼–å†™ç¤ºä¾‹" class="sidebar-link">loader ç¼–å†™ç¤ºä¾‹</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/./dailyRecord/webpackAdvanced.html#try-catch-loadere" class="sidebar-link">try/catch loadere</a></li><li class="sidebar-sub-header"><a href="/./dailyRecord/webpackAdvanced.html#less-css-style-loaderé“¾å¤„ç†lessæ ·å¼" class="sidebar-link">less/css/style loaderé“¾å¤„ç†lessæ ·å¼</a></li></ul></li><li class="sidebar-sub-header"><a href="/./dailyRecord/webpackAdvanced.html#æ–‡ä¸­æåˆ°çš„å…¶ä»–loaderä»£ç " class="sidebar-link">æ–‡ä¸­æåˆ°çš„å…¶ä»–loaderä»£ç ï¼š</a></li><li class="sidebar-sub-header"><a href="/./dailyRecord/webpackAdvanced.html#ç¼–å†™-pulgin-çš„å‰ç½®çŸ¥è¯†" class="sidebar-link">ç¼–å†™ Pulgin çš„å‰ç½®çŸ¥è¯†</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/./dailyRecord/webpackAdvanced.html#tapable" class="sidebar-link">tapable</a></li></ul></li><li class="sidebar-sub-header"><a href="/./dailyRecord/webpackAdvanced.html#è¡¥å……èµ„æ–™" class="sidebar-link">è¡¥å……èµ„æ–™ï¼š</a></li></ul></li><li><a href="/./dailyRecord/vite.html" class="sidebar-link">vite</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>å‰ç«¯å¼‚å¸¸ç›‘æ§</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue3åŸç†</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue3æºç </span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>å†…åŠŸä¿®ç‚¼</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>æ€»ç»“</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>GIS</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="webpack-æ‰“åŒ…åˆ†æä»¥åŠloaderç¼–å†™"><a href="#webpack-æ‰“åŒ…åˆ†æä»¥åŠloaderç¼–å†™" class="header-anchor">#</a> Webpack æ‰“åŒ…åˆ†æä»¥åŠloaderç¼–å†™</h1> <p>ä½¿ç”¨webpackå¯¹æˆ‘ä»¬çš„ä»£ç è¿›è¡Œæ‰“åŒ…ï¼Œæˆ‘ä»¬å†ç†Ÿæ‚‰ä¸è¿‡äº†ã€‚ä½†æ˜¯æˆ‘ä»¬æœ‰å¯¹webpackæ‰“åŒ…æµç¨‹ï¼Œä»¥åŠæ‰“åŒ…ç»“æœè¿›è¡Œåˆ†æå­¦ä¹ è¿‡å—ï¼Ÿäº¦æˆ–æ˜¯è‡ªå·±å¼€å‘ä¸€ä¸ªloaderè§£å†³ä¸€äº›é—®é¢˜ï¼Ÿ</p> <p>ä»Šå¤©æˆ‘å°±åˆ†äº«ä¸€ä¸‹æˆ‘å¯¹webpackçš„å­¦ä¹ çš„å†…å®¹ï¼ŒæŠ›ç –å¼•ç‰ï¼Œå¸Œæœ›å¯ä»¥å¸®åŠ©åˆ°å¤§å®¶ã€‚</p> <p><img src="./assets/img/1.1a254601.png" alt="image"></p> <h2 id="æ‰“åŒ…æ–‡ä»¶åˆ†æ-webpack4"><a href="#æ‰“åŒ…æ–‡ä»¶åˆ†æ-webpack4" class="header-anchor">#</a> æ‰“åŒ…æ–‡ä»¶åˆ†æï¼ˆwebpack4ï¼‰</h2> <p>æˆ‘ä»¬è™½ç„¶ä¼šä½¿ç”¨ Webpack ï¼Œä¹Ÿå¤§è‡´çŸ¥é“å…¶å·¥ä½œåŸç†ï¼Œå¯æ˜¯ä½ æƒ³è¿‡ Webpack è¾“å‡ºçš„ bundle.js æ˜¯ä»€ä¹ˆæ ·å­çš„å—ï¼Ÿ ä¸ºä»€ä¹ˆåŸæ¥ä¸€ä¸ªä¸ªçš„æ¨¡å—æ–‡ä»¶è¢«åˆå¹¶æˆäº†ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶ï¼Ÿä¸ºä»€ä¹ˆ bundle.js èƒ½ç›´æ¥è¿è¡Œåœ¨æµè§ˆå™¨ä¸­ï¼Ÿè®©æˆ‘ä»¬èµ°è¿›bundle.jsï¼Œæ­å¼€ä»–ç¥ç§˜çš„é¢çº±ã€‚</p> <p><img src="./assets/img/2.8a200a20.jpg" alt="image"></p> <h3 id="webpack-æ‰“åŒ…æµç¨‹å›¾"><a href="#webpack-æ‰“åŒ…æµç¨‹å›¾" class="header-anchor">#</a> webpack æ‰“åŒ…æµç¨‹å›¾</h3> <p><img src="./assets/img/webpack.fe008557.png" alt="image"></p> <h3 id="åŒæ­¥ä»£ç æ‰“åŒ…æ–‡ä»¶åˆ†æ"><a href="#åŒæ­¥ä»£ç æ‰“åŒ…æ–‡ä»¶åˆ†æ" class="header-anchor">#</a> åŒæ­¥ä»£ç æ‰“åŒ…æ–‡ä»¶åˆ†æ</h3> <p>æºç ç›®å½•ç»“æ„å¦‚ä¸‹</p> <div class="language- extra-class"><pre class="language-text"><code>â”œâ”€â”€ src
â”‚   â”œâ”€â”€ js
â”‚       â”œâ”€â”€ show.js
â”œâ”€â”€ main.js
â”œâ”€â”€ index.html
â””â”€â”€ webpack.config.js
</code></pre></div><div class="language-html extra-class"><pre class="language-html"><code>index.html
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>app<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!--å¯¼å…¥ webpack è¾“å‡ºçš„ JS æ–‡ä»¶--&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./dist/app.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code>main<span class="token punctuation">.</span>js<span class="token operator">:</span>
<span class="token comment">// é€šè¿‡ CommonJS è§„èŒƒå¯¼å…¥ show å‡½æ•°</span>
<span class="token keyword">const</span> show <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./src/js/show.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// æ‰§è¡Œ show å‡½æ•°</span>
<span class="token function">show</span><span class="token punctuation">(</span><span class="token string">'Webpack'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code>show<span class="token punctuation">.</span>js<span class="token operator">:</span>
<span class="token comment">// æ“ä½œ DOM å…ƒç´ ï¼ŒæŠŠ content æ˜¾ç¤ºåˆ°ç½‘é¡µä¸Š</span>
<span class="token keyword">function</span> <span class="token function">show</span><span class="token punctuation">(</span><span class="token parameter">content</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  window<span class="token punctuation">.</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'app'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">'Hello,'</span> <span class="token operator">+</span> content<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// é€šè¿‡ CommonJS è§„èŒƒå¯¼å‡º show å‡½æ•°</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> show<span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code>webpack<span class="token punctuation">.</span>config<span class="token punctuation">.</span>js<span class="token operator">:</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// JS æ‰§è¡Œå…¥å£æ–‡ä»¶</span>
  <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">&quot;development&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token string">'./main.js'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// æŠŠæ‰€æœ‰ä¾èµ–çš„æ¨¡å—åˆå¹¶è¾“å‡ºåˆ°ä¸€ä¸ª bundle.js æ–‡ä»¶</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">'app.js'</span><span class="token punctuation">,</span>
    <span class="token comment">// è¾“å‡ºæ–‡ä»¶éƒ½æ”¾åˆ° dist ç›®å½•ä¸‹</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">publicPath</span><span class="token operator">:</span> <span class="token string">&quot;./dist/&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">chunkFilename</span><span class="token operator">:</span><span class="token string">'[name].chunk.js'</span> 
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>æˆ‘ä»¬åœ¨çœ‹å®Œæ•´æ‰“åŒ…ä»£ç ä¹‹å‰ï¼Œå…ˆæ‹†åˆ†ä¸€ä¸‹ï¼Œé€ä¸ªå‡»ç ´ï¼š</p> <p>æœ€å¤–é¢çš„ä»£ç ç»“æ„ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">modules</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token operator">...</span><span class="token punctuation">(</span>webpackçš„å‡½æ•°<span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token function">__webpack_require__</span><span class="token punctuation">(</span>__webpack_require__<span class="token punctuation">.</span>s <span class="token operator">=</span> <span class="token string">&quot;./demo01/main.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>
 <span class="token punctuation">{</span>
   <span class="token string-property property">&quot;./main.js&quot;</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
   <span class="token string-property property">&quot;./src/js/show.js&quot;</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre></div><p>æœ€å¤–å±‚æ˜¯ä¸€ä¸ªç«‹å³æ‰§è¡Œå‡½æ•°,å‚æ•°æ˜¯ modules ä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„å¼•ç”¨æ–‡ä»¶ã€‚æ¯ä¸ªæ–‡ä»¶å°±æ˜¯ä¸€ä¸ª moduleï¼Œæˆ‘ä»¬å†™çš„ requireï¼Œåˆ™æœ€ç»ˆå˜ä¸º <strong>webpack_require</strong> å‡½æ•°æ‰§è¡Œã€‚</p> <p>__webpack_require__å‡½æ•°ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// å»æ¨¡å—å¯¹è±¡ä¸­åŠ è½½ä¸€ä¸ªæ¨¡å—ï¼ŒmoduleId ä¸ºè¦åŠ è½½çš„æ¨¡å—</span>
  <span class="token keyword">function</span> <span class="token function">__webpack_require__</span><span class="token punctuation">(</span><span class="token parameter">moduleId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// å¦‚æœéœ€è¦åŠ è½½çš„æ¨¡å—å·²ç»è¢«åŠ è½½è¿‡ï¼Œå°±ç›´æ¥ä»å†…å­˜ç¼“å­˜ä¸­è¿”å›</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>installedModules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> installedModules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">.</span>exports<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// å¦‚æœç¼“å­˜ä¸­ä¸å­˜åœ¨éœ€è¦åŠ è½½çš„æ¨¡å—ï¼Œå°±æ–°å»ºä¸€ä¸ªæ¨¡å—ï¼Œå¹¶æŠŠå®ƒå­˜åœ¨ç¼“å­˜ä¸­</span>
    <span class="token keyword">var</span> module <span class="token operator">=</span> installedModules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token comment">// æ¨¡å—çš„åç§°</span>
      <span class="token literal-property property">i</span><span class="token operator">:</span> moduleId<span class="token punctuation">,</span>
      <span class="token comment">// è¯¥æ¨¡å—æ˜¯å¦å·²ç»åŠ è½½å®Œæ¯•</span>
      <span class="token literal-property property">l</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token comment">// è¯¥æ¨¡å—çš„å¯¼å‡ºå€¼</span>
      <span class="token literal-property property">exports</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment">// ä» modules ä¸­è·å–åç§°ä¸º moduleId çš„æ¨¡å—å¯¹åº”çš„å‡½æ•°</span>
    <span class="token comment">// å†è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼ŒåŒæ—¶æŠŠå‡½æ•°éœ€è¦çš„å‚æ•°ä¼ å…¥</span>
    modules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>module<span class="token punctuation">.</span>exports<span class="token punctuation">,</span> module<span class="token punctuation">,</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">,</span> __webpack_require__<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// æŠŠè¿™ä¸ªæ¨¡å—æ ‡è®°ä¸ºå·²åŠ è½½</span>
    module<span class="token punctuation">.</span>l <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

    <span class="token comment">// è¿”å›è¿™ä¸ªæ¨¡å—çš„å¯¼å‡ºå€¼</span>
    <span class="token keyword">return</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>ç°åœ¨å†çœ‹çœ‹é€šè¿‡webpackæ‰“åŒ…åçš„ä»£ç ã€‚(ç²¾ç®€å¤„ç†åå¦‚ä¸‹)</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// webpackBootstrapå¯åŠ¨å‡½æ•°</span>
<span class="token comment">// modules å³ä¸ºå­˜æ”¾æ‰€æœ‰æ¨¡å—çš„å¯¹è±¡ï¼Œå¯¹è±¡ä¸­çš„æ¯ä¸€ä¸ªå±æ€§éƒ½æ˜¯ä¸€ä¸ªå‡½æ•°</span>
<span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">modules</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// å®‰è£…è¿‡çš„æ¨¡å—éƒ½å­˜æ”¾åœ¨è¿™é‡Œé¢</span>
  <span class="token comment">// ä½œç”¨æ˜¯æŠŠå·²ç»åŠ è½½è¿‡çš„æ¨¡å—ç¼“å­˜åœ¨å†…å­˜ä¸­ï¼Œæå‡æ€§èƒ½</span>
  <span class="token keyword">var</span> installedModules <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token comment">// å»æ¨¡å—å¯¹è±¡ä¸­åŠ è½½ä¸€ä¸ªæ¨¡å—ï¼ŒmoduleId ä¸ºè¦åŠ è½½çš„æ¨¡å—</span>
  <span class="token keyword">function</span> <span class="token function">__webpack_require__</span><span class="token punctuation">(</span><span class="token parameter">moduleId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// å¦‚æœéœ€è¦åŠ è½½çš„æ¨¡å—å·²ç»è¢«åŠ è½½è¿‡ï¼Œå°±ç›´æ¥ä»å†…å­˜ç¼“å­˜ä¸­è¿”å›</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>installedModules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> installedModules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">.</span>exports<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// å¦‚æœç¼“å­˜ä¸­ä¸å­˜åœ¨éœ€è¦åŠ è½½çš„æ¨¡å—ï¼Œå°±æ–°å»ºä¸€ä¸ªæ¨¡å—ï¼Œå¹¶æŠŠå®ƒå­˜åœ¨ç¼“å­˜ä¸­</span>
    <span class="token keyword">var</span> module <span class="token operator">=</span> installedModules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token comment">// æ¨¡å—çš„åç§°</span>
      <span class="token literal-property property">i</span><span class="token operator">:</span> moduleId<span class="token punctuation">,</span>
      <span class="token comment">// è¯¥æ¨¡å—æ˜¯å¦å·²ç»åŠ è½½å®Œæ¯•</span>
      <span class="token literal-property property">l</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token comment">// è¯¥æ¨¡å—çš„å¯¼å‡ºå€¼</span>
      <span class="token literal-property property">exports</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment">// ä» modules ä¸­è·å–åç§°ä¸º moduleId çš„æ¨¡å—å¯¹åº”çš„å‡½æ•°</span>
    <span class="token comment">// å†è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼ŒåŒæ—¶æŠŠå‡½æ•°éœ€è¦çš„å‚æ•°ä¼ å…¥</span>
    modules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>module<span class="token punctuation">.</span>exports<span class="token punctuation">,</span> module<span class="token punctuation">,</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">,</span> __webpack_require__<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// æŠŠè¿™ä¸ªæ¨¡å—æ ‡è®°ä¸ºå·²åŠ è½½</span>
    module<span class="token punctuation">.</span>l <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

    <span class="token comment">// è¿”å›è¿™ä¸ªæ¨¡å—çš„å¯¼å‡ºå€¼</span>
    <span class="token keyword">return</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// ä¼ å…¥æ¨¡å—å¯¹è±¡</span>
  __webpack_require__<span class="token punctuation">.</span>m <span class="token operator">=</span> modules<span class="token punctuation">;</span>

  <span class="token comment">// ä¼ å…¥æ¨¡å—ç¼“å­˜</span>
  __webpack_require__<span class="token punctuation">.</span>c <span class="token operator">=</span> installedModules<span class="token punctuation">;</span>

  <span class="token comment">// ä½¿ç”¨ __webpack_require__ å»åŠ è½½ main.jsæ¨¡å—ï¼Œå¹¶ä¸”è¿”å›è¯¥æ¨¡å—å¯¼å‡ºçš„å†…å®¹</span>
  <span class="token comment">// main.js å¯¹åº”çš„æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯æ‰§è¡Œå…¥å£æ¨¡å—</span>
  <span class="token comment">// __webpack_require__.s çš„å«ä¹‰æ˜¯å¯åŠ¨æ¨¡å—å¯¹åº”çš„åç§°</span>
  <span class="token keyword">return</span> <span class="token function">__webpack_require__</span><span class="token punctuation">(</span>__webpack_require__<span class="token punctuation">.</span>s <span class="token operator">=</span> <span class="token string">&quot;./main.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">/************************************************************************/</span>
<span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// æ‰€æœ‰çš„æ¨¡å—éƒ½å­˜æ”¾åœ¨äº†ä¸€ä¸ªå¯¹è±¡é‡Œï¼Œæ ¹æ®æ¯ä¸ªæ¨¡å—çš„è·¯å¾„æ¥åŒºåˆ†å’Œå®šä½æ¨¡å—</span>
  <span class="token string-property property">&quot;./main.js&quot;</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> __webpack_require__</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// é€šè¿‡ CommonJS è§„èŒƒå¯¼å…¥ show å‡½æ•° </span>
    <span class="token keyword">const</span> show <span class="token operator">=</span> <span class="token function">__webpack_require__</span><span class="token punctuation">(</span> <span class="token comment">/*! ./src/js/show.js */</span> <span class="token string">&quot;./src/js/show.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// æ‰§è¡Œ show å‡½æ•°</span>
    <span class="token function">show</span><span class="token punctuation">(</span><span class="token string">'Webpack'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  
  <span class="token string-property property">&quot;./src/js/show.js&quot;</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// æ“ä½œ DOM å…ƒç´ ï¼ŒæŠŠ content æ˜¾ç¤ºåˆ°ç½‘é¡µä¸Š</span>
    <span class="token keyword">function</span> <span class="token function">show</span><span class="token punctuation">(</span><span class="token parameter">content</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      window<span class="token punctuation">.</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'app'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">'Hello,'</span> <span class="token operator">+</span> content<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// é€šè¿‡ CommonJS è§„èŒƒå¯¼å‡º show å‡½æ•°</span>
    module<span class="token punctuation">.</span>exports <span class="token operator">=</span> show<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>æ€»ç»“ï¼š</p> <p>ä»¥ä¸Šå°±æ˜¯webpackçš„æ‰“åŒ…æ–‡ä»¶åŒæ­¥åŠ è½½æµç¨‹ï¼Œä¸»è¦çš„åŠŸèƒ½æ˜¯æŠŠè§£æçš„æ¨¡å—å˜æˆä¸€ä¸ªå¯¹è±¡ï¼Œé€šè¿‡ä¸€ä¸ªå…¥å£æ–‡ä»¶å»é€’å½’åŠ è½½ï¼Œè¿è¡Œæ‰€æœ‰çš„æ¨¡å—ã€‚</p> <p>bundle.js èƒ½ç›´æ¥è¿è¡Œåœ¨æµè§ˆå™¨ä¸­çš„åŸå› åœ¨äºè¾“å‡ºçš„æ–‡ä»¶ä¸­é€šè¿‡ __webpack_require__ å‡½æ•°å®šä¹‰äº†ä¸€ä¸ªå¯ä»¥åœ¨æµè§ˆå™¨ä¸­æ‰§è¡Œçš„åŠ è½½å‡½æ•°æ¥åŠ è½½æ¨¡å—ã€‚</p> <p>åŸæ¥ä¸€ä¸ªä¸ªç‹¬ç«‹çš„æ¨¡å—æ–‡ä»¶è¢«åˆå¹¶åˆ°äº†ä¸€ä¸ªå•ç‹¬çš„ bundle.js çš„åŸå› åœ¨äºæµè§ˆå™¨ä¸èƒ½åƒ Node.js é‚£æ ·å¿«é€Ÿåœ°å»æœ¬åœ°åŠ è½½ä¸€ä¸ªä¸ªæ¨¡å—æ–‡ä»¶ï¼Œè€Œå¿…é¡»é€šè¿‡ç½‘ç»œè¯·æ±‚å»åŠ è½½è¿˜æœªå¾—åˆ°çš„æ–‡ä»¶ã€‚ å¦‚æœæ¨¡å—æ•°é‡å¾ˆå¤šï¼ŒåŠ è½½æ—¶é—´ä¼šå¾ˆé•¿ï¼Œå› æ­¤æŠŠæ‰€æœ‰æ¨¡å—éƒ½å­˜æ”¾åœ¨äº†å¯¹è±¡ä¸­ï¼Œæ‰§è¡Œä¸€æ¬¡ç½‘ç»œåŠ è½½ã€‚ï¼ˆå¦‚æœä½“ç§¯å¾ˆå¤§ï¼Œéœ€è¦å°†ä»£ç åˆ†å‰²ï¼ŒæŒ‰éœ€åŠ è½½ï¼‰</p> <p>å¦‚æœä»”ç»†åˆ†æ __webpack_require__ å‡½æ•°çš„å®ç°ï¼Œä½ è¿˜æœ‰å‘ç° Webpack åšäº†ç¼“å­˜ä¼˜åŒ–ï¼š æ‰§è¡ŒåŠ è½½è¿‡çš„æ¨¡å—ä¸ä¼šå†æ‰§è¡Œç¬¬äºŒæ¬¡ï¼Œæ‰§è¡Œç»“æœä¼šç¼“å­˜åœ¨å†…å­˜ä¸­ï¼Œå½“æŸä¸ªæ¨¡å—ç¬¬äºŒæ¬¡è¢«è®¿é—®æ—¶ä¼šç›´æ¥å»å†…å­˜ä¸­è¯»å–è¢«ç¼“å­˜çš„è¿”å›å€¼ã€‚</p> <h3 id="æ‡’åŠ è½½-å¼‚æ­¥ä»£ç -æ‰“åŒ…æ–‡ä»¶åˆ†æ"><a href="#æ‡’åŠ è½½-å¼‚æ­¥ä»£ç -æ‰“åŒ…æ–‡ä»¶åˆ†æ" class="header-anchor">#</a> æ‡’åŠ è½½ï¼ˆå¼‚æ­¥ä»£ç ï¼‰æ‰“åŒ…æ–‡ä»¶åˆ†æ</h3> <h4 id="ç”¨-webpack-å®ç°æŒ‰éœ€åŠ è½½"><a href="#ç”¨-webpack-å®ç°æŒ‰éœ€åŠ è½½" class="header-anchor">#</a> ç”¨ Webpack å®ç°æŒ‰éœ€åŠ è½½</h4> <p>å¢åŠ ä¸€ä¸ªæ‡’åŠ è½½ç”¨çš„jsæ–‡ä»¶</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>å°†show.jsæ–‡ä»¶è¿›è¡Œæ‡’åŠ è½½ä¿®æ”¹</p> <div class="language-js extra-class"><pre class="language-js"><code>show<span class="token punctuation">.</span>js
<span class="token comment">// æ“ä½œ DOM å…ƒç´ ï¼ŒæŠŠ content æ˜¾ç¤ºåˆ°ç½‘é¡µä¸Š</span>
<span class="token keyword">function</span> <span class="token function">show</span><span class="token punctuation">(</span><span class="token parameter">content</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  window<span class="token punctuation">.</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'app'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">'Hello,'</span> <span class="token operator">+</span> content<span class="token punctuation">;</span>
  <span class="token keyword">import</span><span class="token punctuation">(</span> <span class="token comment">/* webpackChunkName: &quot;sum&quot; */</span> <span class="token string">'./sum'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
   <span class="token punctuation">(</span><span class="token parameter">exprot</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> sum <span class="token operator">=</span> exprot<span class="token punctuation">.</span>default
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;sum(1, 2) = &quot;</span><span class="token punctuation">,</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// é€šè¿‡ CommonJS è§„èŒƒå¯¼å‡º show å‡½æ•°</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> show<span class="token punctuation">;</span>
</code></pre></div><p>ä»£ç ä¸­æœ€å…³é”®çš„ä¸€å¥æ˜¯ import( /* webpackChunkName: &quot;sum&quot; */ './sum')ï¼ŒWebpack å†…ç½®äº†å¯¹ import(*) è¯­å¥çš„æ”¯æŒï¼Œå½“ Webpack é‡åˆ°äº†ç±»ä¼¼çš„è¯­å¥æ—¶ä¼šè¿™æ ·å¤„ç†ï¼š</p> <ul><li>ä»¥ ./sum.js ä¸ºå…¥å£æ–°ç”Ÿæˆä¸€ä¸ª Chunk</li> <li>å½“ä»£ç æ‰§è¡Œåˆ° import æ‰€åœ¨è¯­å¥æ—¶æ‰ä¼šå»åŠ è½½ç”± Chunk å¯¹åº”ç”Ÿæˆçš„æ–‡ä»¶ã€‚</li> <li>import è¿”å›ä¸€ä¸ª Promiseï¼Œå½“æ–‡ä»¶åŠ è½½æˆåŠŸæ—¶å¯ä»¥åœ¨ Promise çš„ then æ–¹æ³•ä¸­è·å–åˆ° sum.js å¯¼å‡ºçš„å†…å®¹ã€‚</li></ul> <p>æ‰“åŒ…åå‘ç°æœ‰ä¸¤ä¸ªjsæ–‡ä»¶,app.jså’Œsum.chunk.js</p> <p>å…ˆåˆ†æapp.js</p> <div class="language-js extra-class"><pre class="language-js"><code>app<span class="token punctuation">.</span>js
<span class="token comment">// webpackBootstrapå¯åŠ¨å‡½æ•°</span>
<span class="token comment">// modules å³ä¸ºå­˜æ”¾æ‰€æœ‰æ¨¡å—çš„å¯¹è±¡ï¼Œå¯¹è±¡ä¸­çš„æ¯ä¸€ä¸ªå±æ€§éƒ½æ˜¯ä¸€ä¸ªå‡½æ•°</span>
<span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">modules</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// å®‰è£…è¿‡çš„æ¨¡å—éƒ½å­˜æ”¾åœ¨è¿™é‡Œé¢</span>
  <span class="token comment">// ä½œç”¨æ˜¯æŠŠå·²ç»åŠ è½½è¿‡çš„æ¨¡å—ç¼“å­˜åœ¨å†…å­˜ä¸­ï¼Œæå‡æ€§èƒ½</span>
  <span class="token keyword">var</span> installedModules <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token comment">// å­˜å‚¨æ¯ä¸ª Chunk çš„åŠ è½½çŠ¶æ€ï¼›</span>
  <span class="token comment">// é”®ä¸º Chunk çš„ IDï¼Œå€¼çš„æ„æ€å¦‚ä¸‹ï¼š</span>
  <span class="token comment">// undefined = æ¨¡å—æœªåŠ è½½, </span>
  <span class="token comment">// null = chunk preloaded/prefetched</span>
  <span class="token comment">// Promise = æ¨¡å—æ­£åœ¨åŠ è½½</span>
  <span class="token comment">// 0 = æ¨¡å—å·²ç»åŠ è½½æˆåŠŸ</span>
  <span class="token keyword">var</span> installedChunks <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;main&quot;</span><span class="token operator">:</span> <span class="token number">0</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token comment">// ä¼ å…¥æ¨¡å—å¯¹è±¡</span>
  __webpack_require__<span class="token punctuation">.</span>m <span class="token operator">=</span> modules<span class="token punctuation">;</span>

  <span class="token comment">// ä¼ å…¥æ¨¡å—ç¼“å­˜</span>
  __webpack_require__<span class="token punctuation">.</span>c <span class="token operator">=</span> installedModules<span class="token punctuation">;</span>

  <span class="token comment">// Webpack é…ç½®ä¸­çš„ publicPathï¼Œç”¨äºåŠ è½½è¢«åˆ†å‰²å‡ºå»çš„å¼‚æ­¥ä»£ç </span>
  __webpack_require__<span class="token punctuation">.</span>p <span class="token operator">=</span> <span class="token string">&quot;./dist2/&quot;</span><span class="token punctuation">;</span>

  <span class="token comment">// åŠ è½½ä¸€ä¸ªæ¨¡å—</span>
  <span class="token keyword">function</span> <span class="token function">__webpack_require__</span><span class="token punctuation">(</span><span class="token parameter">moduleId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// å¦‚æœéœ€è¦åŠ è½½çš„æ¨¡å—å·²ç»è¢«åŠ è½½è¿‡ï¼Œå°±ç›´æ¥ä»å†…å­˜ç¼“å­˜ä¸­è¿”å›</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>installedModules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> installedModules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">.</span>exports<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// å¦‚æœç¼“å­˜ä¸­ä¸å­˜åœ¨éœ€è¦åŠ è½½çš„æ¨¡å—ï¼Œå°±æ–°å»ºä¸€ä¸ªæ¨¡å—ï¼Œå¹¶æŠŠå®ƒå­˜åœ¨ç¼“å­˜ä¸­</span>
    <span class="token keyword">var</span> module <span class="token operator">=</span> installedModules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token comment">// æ¨¡å—çš„åç§°</span>
      <span class="token literal-property property">i</span><span class="token operator">:</span> moduleId<span class="token punctuation">,</span>
      <span class="token comment">// è¯¥æ¨¡å—æ˜¯å¦å·²ç»åŠ è½½å®Œæ¯•</span>
      <span class="token literal-property property">l</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token comment">// è¯¥æ¨¡å—çš„å¯¼å‡ºå€¼</span>
      <span class="token literal-property property">exports</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment">// ä» modules ä¸­è·å–åç§°ä¸º moduleId çš„æ¨¡å—å¯¹åº”çš„å‡½æ•°</span>
    <span class="token comment">// å†è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼ŒåŒæ—¶æŠŠå‡½æ•°éœ€è¦çš„å‚æ•°ä¼ å…¥</span>
    modules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>module<span class="token punctuation">.</span>exports<span class="token punctuation">,</span> module<span class="token punctuation">,</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">,</span> __webpack_require__<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// æŠŠè¿™ä¸ªæ¨¡å—æ ‡è®°ä¸ºå·²åŠ è½½</span>
    module<span class="token punctuation">.</span>l <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

    <span class="token comment">// è¿”å›è¿™ä¸ªæ¨¡å—çš„å¯¼å‡ºå€¼</span>
    <span class="token keyword">return</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// å¼‚æ­¥åŠ è½½çš„æ–‡ä»¶ä¸­å®‰è£…æ¨¡å—</span>
  <span class="token keyword">function</span> <span class="token function">webpackJsonpCallback</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// å¼‚æ­¥åŠ è½½çš„æ–‡ä»¶ä¸­å­˜æ”¾çš„éœ€è¦å®‰è£…çš„æ¨¡å—å¯¹åº”çš„ Chunk ID</span>
    <span class="token keyword">var</span> chunkIds <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// å¼‚æ­¥åŠ è½½çš„æ–‡ä»¶ä¸­å­˜æ”¾çš„éœ€è¦å®‰è£…çš„æ¨¡å—åˆ—è¡¨</span>
    <span class="token keyword">var</span> moreModules <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token comment">// æŠŠ moreModules æ·»åŠ åˆ° modules å¯¹è±¡ä¸­</span>
    <span class="token comment">// æŠŠæ‰€æœ‰ chunkIds å¯¹åº”çš„æ¨¡å—éƒ½æ ‡è®°æˆå·²ç»åŠ è½½æˆåŠŸ</span>
    <span class="token keyword">var</span> moduleId<span class="token punctuation">,</span> chunkId<span class="token punctuation">,</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
      resolves <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> chunkIds<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      chunkId <span class="token operator">=</span> chunkIds<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>installedChunks<span class="token punctuation">,</span> chunkId<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> installedChunks<span class="token punctuation">[</span>chunkId<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        resolves<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>installedChunks<span class="token punctuation">[</span>chunkId<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      installedChunks<span class="token punctuation">[</span>chunkId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>moduleId <span class="token keyword">in</span> moreModules<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>moreModules<span class="token punctuation">,</span> moduleId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        modules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span> <span class="token operator">=</span> moreModules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>parentJsonpFunction<span class="token punctuation">)</span> <span class="token function">parentJsonpFunction</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">while</span> <span class="token punctuation">(</span>resolves<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      resolves<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token comment">// script æ ‡ç­¾è·¯å¾„</span>
  <span class="token keyword">function</span> <span class="token function">jsonpScriptSrc</span><span class="token punctuation">(</span><span class="token parameter">chunkId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> __webpack_require__<span class="token punctuation">.</span>p <span class="token operator">+</span> <span class="token string">&quot;&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token string-property property">&quot;sum&quot;</span><span class="token operator">:</span> <span class="token string">&quot;sum&quot;</span>
    <span class="token punctuation">}</span> <span class="token punctuation">[</span>chunkId<span class="token punctuation">]</span> <span class="token operator">||</span> chunkId<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;.chunk.js&quot;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * ç”¨äºåŠ è½½è¢«åˆ†å‰²å‡ºå»çš„ï¼Œéœ€è¦å¼‚æ­¥åŠ è½½çš„ Chunk å¯¹åº”çš„æ–‡ä»¶
   * @param chunkId éœ€è¦å¼‚æ­¥åŠ è½½çš„ Chunk å¯¹åº”çš„ ID
   * @returns {Promise}
   */</span>
  __webpack_require__<span class="token punctuation">.</span><span class="token function-variable function">e</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">requireEnsure</span><span class="token punctuation">(</span><span class="token parameter">chunkId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> promises <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token comment">// ä»ä¸Šé¢å®šä¹‰çš„ installedChunks ä¸­è·å– chunkId å¯¹åº”çš„ Chunk çš„åŠ è½½çŠ¶æ€</span>
    <span class="token keyword">var</span> installedChunkData <span class="token operator">=</span> installedChunks<span class="token punctuation">[</span>chunkId<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>installedChunkData <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// å¦‚æœåŠ è½½çŠ¶æ€ä¸º0è¡¨ç¤ºè¯¥ Chunk å·²ç»åŠ è½½æˆåŠŸäº†</span>

      <span class="token comment">// installedChunkData ä¸ä¸ºç©ºä¸”ä¸ä¸º0è¡¨ç¤ºè¯¥ Chunk æ­£åœ¨ç½‘ç»œåŠ è½½ä¸­</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>installedChunkData<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// è¿”å›å­˜æ”¾åœ¨ installedChunkData æ•°ç»„ä¸­çš„ Promise å¯¹è±¡</span>
        promises<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>installedChunkData<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// installedChunkData ä¸ºç©ºï¼Œè¡¨ç¤ºè¯¥ Chunk è¿˜æ²¡æœ‰åŠ è½½è¿‡ï¼Œå»åŠ è½½è¯¥ Chunk å¯¹åº”çš„æ–‡ä»¶</span>
        <span class="token keyword">var</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          installedChunkData <span class="token operator">=</span> installedChunks<span class="token punctuation">[</span>chunkId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        promises<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>installedChunkData<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> promise<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// é€šè¿‡ DOM æ“ä½œï¼Œå¾€ HTML head ä¸­æ’å…¥ä¸€ä¸ª script æ ‡ç­¾å»å¼‚æ­¥åŠ è½½ Chunk å¯¹åº”çš„ JavaScript æ–‡ä»¶</span>
        <span class="token keyword">var</span> script <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'script'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> onScriptComplete<span class="token punctuation">;</span>

        script<span class="token punctuation">.</span>charset <span class="token operator">=</span> <span class="token string">'utf-8'</span><span class="token punctuation">;</span>
        script<span class="token punctuation">.</span>timeout <span class="token operator">=</span> <span class="token number">120</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>__webpack_require__<span class="token punctuation">.</span>nc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          script<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;nonce&quot;</span><span class="token punctuation">,</span> __webpack_require__<span class="token punctuation">.</span>nc<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        script<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token function">jsonpScriptSrc</span><span class="token punctuation">(</span>chunkId<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// create error before stack unwound to get useful stacktrace later</span>
        <span class="token keyword">var</span> error <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// åœ¨ script åŠ è½½å’Œæ‰§è¡Œå®Œæˆæ—¶å›è°ƒ</span>
        <span class="token function-variable function">onScriptComplete</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// é˜²æ­¢å†…å­˜æ³„éœ²</span>
          script<span class="token punctuation">.</span>onerror <span class="token operator">=</span> script<span class="token punctuation">.</span>onload <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
          <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token comment">// å»æ£€æŸ¥ chunkId å¯¹åº”çš„ Chunk æ˜¯å¦å®‰è£…æˆåŠŸï¼Œå®‰è£…æˆåŠŸæ—¶æ‰ä¼šå­˜åœ¨äº installedChunks ä¸­</span>
          <span class="token keyword">var</span> chunk <span class="token operator">=</span> installedChunks<span class="token punctuation">[</span>chunkId<span class="token punctuation">]</span><span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>chunk <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>chunk<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token keyword">var</span> errorType <span class="token operator">=</span> event <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'load'</span> <span class="token operator">?</span> <span class="token string">'missing'</span> <span class="token operator">:</span> event<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token keyword">var</span> realSrc <span class="token operator">=</span> event <span class="token operator">&amp;&amp;</span> event<span class="token punctuation">.</span>target <span class="token operator">&amp;&amp;</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>src<span class="token punctuation">;</span>
              error<span class="token punctuation">.</span>message <span class="token operator">=</span> <span class="token string">'Loading chunk '</span> <span class="token operator">+</span> chunkId <span class="token operator">+</span> <span class="token string">' failed.\n('</span> <span class="token operator">+</span> errorType <span class="token operator">+</span> <span class="token string">': '</span> <span class="token operator">+</span> realSrc <span class="token operator">+</span> <span class="token string">')'</span><span class="token punctuation">;</span>
              error<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'ChunkLoadError'</span><span class="token punctuation">;</span>
              error<span class="token punctuation">.</span>type <span class="token operator">=</span> errorType<span class="token punctuation">;</span>
              error<span class="token punctuation">.</span>request <span class="token operator">=</span> realSrc<span class="token punctuation">;</span>
              chunk<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            installedChunks<span class="token punctuation">[</span>chunkId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token comment">// è®¾ç½®å¼‚æ­¥åŠ è½½çš„æœ€é•¿è¶…æ—¶æ—¶é—´</span>
        <span class="token keyword">var</span> timeout <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">onScriptComplete</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'timeout'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">target</span><span class="token operator">:</span> script
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">120000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        script<span class="token punctuation">.</span>onerror <span class="token operator">=</span> script<span class="token punctuation">.</span>onload <span class="token operator">=</span> onScriptComplete<span class="token punctuation">;</span>
        document<span class="token punctuation">.</span>head<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>promises<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token comment">// define __esModule on exports</span>
  __webpack_require__<span class="token punctuation">.</span><span class="token function-variable function">r</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">exports</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> Symbol <span class="token operator">!==</span> <span class="token string">'undefined'</span> <span class="token operator">&amp;&amp;</span> Symbol<span class="token punctuation">.</span>toStringTag<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> Symbol<span class="token punctuation">.</span>toStringTag<span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'Module'</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> <span class="token string">'__esModule'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token comment">/***
   * webpackJsonp ç”¨äºä»å¼‚æ­¥åŠ è½½çš„æ–‡ä»¶ä¸­å®‰è£…æ¨¡å—ã€‚
   * æŠŠ webpackJsonp æŒ‚è½½åˆ°å…¨å±€æ˜¯ä¸ºäº†æ–¹ä¾¿åœ¨å…¶å®ƒæ–‡ä»¶ä¸­è°ƒç”¨ã€‚
   */</span>
  <span class="token keyword">var</span> jsonpArray <span class="token operator">=</span> window<span class="token punctuation">[</span><span class="token string">&quot;webpackJsonp&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> window<span class="token punctuation">[</span><span class="token string">&quot;webpackJsonp&quot;</span><span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> oldJsonpFunction <span class="token operator">=</span> jsonpArray<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>jsonpArray<span class="token punctuation">)</span><span class="token punctuation">;</span>
  jsonpArray<span class="token punctuation">.</span>push <span class="token operator">=</span> webpackJsonpCallback<span class="token punctuation">;</span>
  jsonpArray <span class="token operator">=</span> jsonpArray<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> jsonpArray<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token function">webpackJsonpCallback</span><span class="token punctuation">(</span>jsonpArray<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> parentJsonpFunction <span class="token operator">=</span> oldJsonpFunction<span class="token punctuation">;</span>

  <span class="token comment">// ä½¿ç”¨ __webpack_require__ å»åŠ è½½ main.jsæ¨¡å—</span>
  <span class="token keyword">return</span> <span class="token function">__webpack_require__</span><span class="token punctuation">(</span>__webpack_require__<span class="token punctuation">.</span>s <span class="token operator">=</span> <span class="token string">&quot;./main.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">/************************************************************************/</span>
<span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// æ‰€æœ‰çš„æ¨¡å—éƒ½å­˜æ”¾åœ¨äº†ä¸€ä¸ªå¯¹è±¡é‡Œï¼Œæ ¹æ®æ¯ä¸ªæ¨¡å—çš„è·¯å¾„æ¥åŒºåˆ†å’Œå®šä½æ¨¡å—</span>
  <span class="token string-property property">&quot;./main.js&quot;</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> __webpack_require__</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// é€šè¿‡ CommonJS è§„èŒƒå¯¼å…¥ show å‡½æ•° </span>
    <span class="token keyword">const</span> show <span class="token operator">=</span> <span class="token function">__webpack_require__</span><span class="token punctuation">(</span> <span class="token comment">/*! ./src/js/show.js */</span> <span class="token string">&quot;./src/js/show.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// æ‰§è¡Œ show å‡½æ•°</span>
    <span class="token function">show</span><span class="token punctuation">(</span><span class="token string">'Webpack'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

  <span class="token string-property property">&quot;./src/js/show.js&quot;</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> __webpack_require__</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// æ“ä½œ DOM å…ƒç´ ï¼ŒæŠŠ content æ˜¾ç¤ºåˆ°ç½‘é¡µä¸Š</span>
    <span class="token keyword">function</span> <span class="token function">show</span><span class="token punctuation">(</span><span class="token parameter">content</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      window<span class="token punctuation">.</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'app'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">'Hello,'</span> <span class="token operator">+</span> content<span class="token punctuation">;</span>
      __webpack_require__<span class="token punctuation">.</span><span class="token function">e</span><span class="token punctuation">(</span> <span class="token comment">/*! import() | sum */</span> <span class="token string">&quot;sum&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
        <span class="token function">__webpack_require__</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">/*! ./sum */</span> <span class="token string">&quot;./src/js/sum.js&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
        <span class="token punctuation">(</span><span class="token parameter">exprot</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> sum <span class="token operator">=</span> exprot<span class="token punctuation">.</span>default
          window<span class="token punctuation">.</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'sum'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">'1 + 2 = '</span> <span class="token operator">+</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// é€šè¿‡ CommonJS è§„èŒƒå¯¼å‡º show å‡½æ•°</span>
    module<span class="token punctuation">.</span>exports <span class="token operator">=</span> show<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code>sum<span class="token punctuation">.</span>chunk<span class="token punctuation">.</span><span class="token function">js</span>
<span class="token punctuation">(</span>window<span class="token punctuation">[</span><span class="token string">&quot;webpackJsonp&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> window<span class="token punctuation">[</span><span class="token string">&quot;webpackJsonp&quot;</span><span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">[</span><span class="token string">&quot;sum&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;./vendor/sum.js&quot;</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> __webpack_exports__<span class="token punctuation">,</span> __webpack_require__</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;use strict&quot;</span><span class="token punctuation">;</span>
      __webpack_require__<span class="token punctuation">.</span><span class="token function">r</span><span class="token punctuation">(</span>__webpack_exports__<span class="token punctuation">)</span><span class="token punctuation">;</span>
      __webpack_exports__<span class="token punctuation">[</span><span class="token string">&quot;default&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>è¿™é‡Œçš„ bundle.js å’Œä¸Šé¢æ‰€è®²çš„ bundle.js éå¸¸ç›¸ä¼¼ï¼ŒåŒºåˆ«åœ¨äºï¼š</p> <p>å¤šäº†ä¸€ä¸ª __webpack_require__.e ç”¨äºåŠ è½½è¢«åˆ†å‰²å‡ºå»çš„ï¼Œéœ€è¦å¼‚æ­¥åŠ è½½çš„ Chunk å¯¹åº”çš„æ–‡ä»¶;
å¤šäº†ä¸€ä¸ª webpackJsonp å‡½æ•°ç”¨äºä»å¼‚æ­¥åŠ è½½çš„æ–‡ä»¶ä¸­å®‰è£…æ¨¡å—ã€‚</p> <h3 id="æ‰“åŒ…æ–‡ä»¶åŠ è½½æµç¨‹åˆ†æå›¾"><a href="#æ‰“åŒ…æ–‡ä»¶åŠ è½½æµç¨‹åˆ†æå›¾" class="header-anchor">#</a> æ‰“åŒ…æ–‡ä»¶åŠ è½½æµç¨‹åˆ†æå›¾</h3> <p><img src="./assets/img/3.94a76466.png" alt="image"></p> <h2 id="ç¼–å†™-loader-çš„å‰ç½®çŸ¥è¯†"><a href="#ç¼–å†™-loader-çš„å‰ç½®çŸ¥è¯†" class="header-anchor">#</a> ç¼–å†™ Loader çš„å‰ç½®çŸ¥è¯†</h2> <p>ç”±äºwebpackåªèƒ½å¤„ç†jsçš„æ¨¡å—ï¼Œå¦‚æœè¦å¤„ç†å…¶ä»–ç±»å‹çš„æ–‡ä»¶ï¼Œéœ€è¦ä½¿ç”¨loaderè¿›è¡Œè½¬æ¢ï¼ŒLoader å°±åƒæ˜¯ä¸€ä¸ªç¿»è¯‘å‘˜ï¼Œèƒ½æŠŠæºæ–‡ä»¶ç»è¿‡è½¬åŒ–åè¾“å‡ºæ–°çš„ç»“æœï¼Œå¹¶ä¸”ä¸€ä¸ªæ–‡ä»¶è¿˜å¯ä»¥é“¾å¼çš„ç»è¿‡å¤šä¸ªç¿»è¯‘å‘˜ç¿»è¯‘ã€‚</p> <p><img src="./assets/img/4.2ecf149d.jpg" alt="image"></p> <h3 id="loader-å¤„ç†æ¨¡å—æµç¨‹"><a href="#loader-å¤„ç†æ¨¡å—æµç¨‹" class="header-anchor">#</a> loader å¤„ç†æ¨¡å—æµç¨‹</h3> <p><img src="./assets/img/7.e42b6fe0.png" alt="image"></p> <p>åœ¨ module ä¸€å¼€å§‹æ„å»ºçš„è¿‡ç¨‹ä¸­ï¼Œé¦–å…ˆä¼šåˆ›å»ºä¸€ä¸ª loaderContext å¯¹è±¡ï¼Œå®ƒå’Œè¿™ä¸ª module æ˜¯ä¸€ä¸€å¯¹åº”çš„å…³ç³»ï¼Œè€Œè¿™ä¸ª module æ‰€ä½¿ç”¨çš„æ‰€æœ‰ loaders éƒ½ä¼šå…±äº«è¿™ä¸ª loaderContext å¯¹è±¡ï¼Œæ¯ä¸ª loader æ‰§è¡Œçš„æ—¶å€™ä¸Šä¸‹æ–‡å°±æ˜¯è¿™ä¸ª loaderContext å¯¹è±¡ï¼Œæ‰€ä»¥å¯ä»¥åœ¨æˆ‘ä»¬å†™çš„ loader é‡Œé¢é€šè¿‡ this æ¥è®¿é—®ã€‚</p> <h3 id="loader-çš„èŒè´£"><a href="#loader-çš„èŒè´£" class="header-anchor">#</a> loader çš„èŒè´£</h3> <p><strong>ä¸€ä¸ª Loader çš„èŒè´£æ˜¯å•ä¸€çš„ï¼Œåªéœ€è¦å®Œæˆä¸€ç§è½¬æ¢ã€‚</strong> å¦‚æœä¸€ä¸ªæºæ–‡ä»¶éœ€è¦ç»å†å¤šæ­¥è½¬æ¢æ‰èƒ½æ­£å¸¸ä½¿ç”¨ï¼Œå°±é€šè¿‡å¤šä¸ª Loader å»è½¬æ¢ã€‚åœ¨è°ƒç”¨å¤šä¸ª Loader å»è½¬æ¢ä¸€ä¸ªæ–‡ä»¶æ—¶ï¼Œæ¯ä¸ª Loader ä¼šé“¾å¼çš„é¡ºåºæ‰§è¡Œï¼Œç¬¬ä¸€ä¸ª Loader å°†ä¼šæ‹¿åˆ°éœ€å¤„ç†çš„åŸå†…å®¹ï¼Œä¸Šä¸€ä¸ª Loader å¤„ç†åçš„ç»“æœä¼šä¼ ç»™ä¸‹ä¸€ä¸ªæ¥ç€å¤„ç†ï¼Œæœ€åçš„ Loader å°†å¤„ç†åçš„æœ€ç»ˆç»“æœè¿”å›ç»™ Webpackã€‚</p> <p>æ‰€ä»¥ï¼Œåœ¨å¼€å‘ä¸€ä¸ª Loader æ—¶ï¼Œè¯·ä¿æŒå…¶èŒè´£çš„å•ä¸€æ€§ï¼Œä½ åªéœ€å…³å¿ƒè¾“å…¥å’Œè¾“å‡ºã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.less$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
  <span class="token literal-property property">use</span><span class="token operator">:</span><span class="token punctuation">[</span>
    <span class="token comment">// é€šè¿‡JSè„šæœ¬åˆ›å»ºstyleæ ‡ç­¾åˆ°é¡µé¢ä¸Š</span>
    <span class="token string">'style-loader'</span><span class="token punctuation">,</span>
    <span class="token comment">// å°†CSSè§£æä¸ºCommonJSä»£ç </span>
    <span class="token string">'css-loader'</span><span class="token punctuation">,</span>
    <span class="token comment">// å°†lessè§£æä¸ºcss</span>
    <span class="token string">'less-loader'</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="loader-åŸºç¡€"><a href="#loader-åŸºç¡€" class="header-anchor">#</a> Loader åŸºç¡€</h3> <p>ç”±äº Webpack æ˜¯è¿è¡Œåœ¨ Node.js ä¹‹ä¸Šçš„ï¼Œ <strong>ä¸€ä¸ª Loaderå…¶å®å°±æ˜¯ä¸€ä¸ª Node.jsæ¨¡å—ï¼Œè¿™ä¸ªæ¨¡å—éœ€è¦å¯¼å‡ºä¸€ä¸ªå‡½æ•°ã€‚</strong> è¿™ä¸ªå¯¼å‡ºçš„å‡½æ•°çš„å·¥ä½œå°±æ˜¯è·å¾—å¤„ç†å‰çš„åŸå†…å®¹ï¼Œå¯¹åŸå†…å®¹æ‰§è¡Œå¤„ç†åï¼Œè¿”å›å¤„ç†åçš„å†…å®¹ã€‚</p> <p>ä¸€ä¸ªloaderæœ€åŸºç¡€çš„ç»“æ„ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">loader</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// å¤„ç†source</span>
  <span class="token keyword">return</span> source<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> loader
</code></pre></div><blockquote><p>loader å¯ä»¥è¢«é“¾å¼è°ƒç”¨æ„å‘³ç€ä¸ä¸€å®šè¦è¾“å‡º JavaScriptã€‚åªè¦ä¸‹ä¸€ä¸ª loader å¯ä»¥å¤„ç†è¿™ä¸ªè¾“å‡ºï¼Œè¿™ä¸ª loader å°±å¯ä»¥è¿”å›ä»»æ„ç±»å‹çš„æ¨¡å—ã€‚</p></blockquote> <h3 id="åŠ è½½è°ƒè¯•æœ¬åœ°-loader"><a href="#åŠ è½½è°ƒè¯•æœ¬åœ°-loader" class="header-anchor">#</a> åŠ è½½è°ƒè¯•æœ¬åœ° Loader</h3> <h4 id="ä½¿ç”¨æœ¬åœ°-loader"><a href="#ä½¿ç”¨æœ¬åœ°-loader" class="header-anchor">#</a> ä½¿ç”¨æœ¬åœ° loader</h4> <p>åœ¨æœ¬åœ°å¼€å‘loaderçš„æ—¶å€™ï¼Œå»ºè®®æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸‹ï¼Œç„¶åé…ç½®webpacké…ç½®ï¼Œå¦‚ä¸‹ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// åœ¨åŒ¹é…åˆ°éœ€è¦ä½¿ç”¨loaderçš„æ—¶å€™ï¼Œä¼šåœ¨node_modulesæ–‡ä»¶å¤¹ä¸‹æ‰¾ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°å°±å»æˆ‘ä»¬è‡ªå·±é…çš„æ–‡ä»¶å¤¹ä¸‹å¯»æ‰¾</span>
<span class="token literal-property property">resolveLoader</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">modules</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'node_modules'</span><span class="token punctuation">,</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'loaders'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token comment">// å¯¹æ‰€æœ‰jsç»“å°¾çš„æ–‡ä»¶ä½¿ç”¨my-loader</span>
<span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
      <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
      <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&quot;my-loader&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;luojw&quot;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="è°ƒè¯•æœ¬åœ°-loader-vscode"><a href="#è°ƒè¯•æœ¬åœ°-loader-vscode" class="header-anchor">#</a> è°ƒè¯•æœ¬åœ° loaderï¼ˆVSCODEï¼‰</h4> <p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦åœ¨package.jsoné…ç½®scriptï¼š</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// --inspect-brkæŒ‡å®šåœ¨ç¬¬ä¸€è¡Œå°±è®¾ç½®æ–­ç‚¹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€å¼€å§‹è¿è¡Œï¼Œå°±æ˜¯æš‚åœçš„çŠ¶æ€ã€‚</span>
    <span class="token property">&quot;debug&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node --inspect-brk=5229 ./node_modules/webpack/bin/webpack&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;devDependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    ...
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;dependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    ...
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>åœ¨vocedeçš„debugä¸­æ·»åŠ æ–°çš„é…ç½®ï¼š</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0.2.0&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;configurations&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;request&quot;</span><span class="token operator">:</span> <span class="token string">&quot;launch&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Debug&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;runtimeExecutable&quot;</span><span class="token operator">:</span> <span class="token string">&quot;yarn&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;runtimeArgs&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;debug&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token property">&quot;port&quot;</span><span class="token operator">:</span> <span class="token number">5229</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token comment">// runtimeExecutable: ç¨‹åºæ‰§è¡Œå™¨ï¼Œå°±æ˜¯å¯åŠ¨ç¨‹åºçš„è„šæœ¬ã€‚é»˜è®¤æ˜¯ nodeï¼Œä½†æˆ‘ä»¬è¿™é‡Œç”¨ yarn æ¥å¯åŠ¨ webpack</span>
<span class="token comment">// runtimeArgs: ä¼ é€’ç»™ç¨‹åºæ‰§è¡Œå™¨çš„å‚æ•°</span>
<span class="token comment">// port: node è°ƒè¯•ç«¯å£å·ï¼Œå’Œåˆšæ‰åœ¨ package.json script ä¸­é…çš„ --inspect-brk ä¿æŒä¸€è‡´</span>
</code></pre></div><h3 id="loader-å·¥å…·åº“"><a href="#loader-å·¥å…·åº“" class="header-anchor">#</a> loader å·¥å…·åº“</h3> <p>å……åˆ†åˆ©ç”¨ loader-utils åŒ…ã€‚å®ƒæä¾›äº†è®¸å¤šæœ‰ç”¨çš„å·¥å…·ï¼Œä½†æœ€å¸¸ç”¨çš„ä¸€ç§å·¥å…·æ˜¯è·å–ä¼ é€’ç»™ loader çš„é€‰é¡¹ã€‚schema-utils åŒ…é…åˆ loader-utilsï¼Œç”¨äºä¿è¯ loader é€‰é¡¹ï¼Œè¿›è¡Œä¸ JSON Schema ç»“æ„ä¸€è‡´çš„æ ¡éªŒã€‚è¿™é‡Œæœ‰ä¸€ä¸ªç®€å•ä½¿ç”¨ä¸¤è€…çš„ä¾‹å­ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> getOptions <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'loader-utils'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> validateOptions <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'schema-utils'</span><span class="token punctuation">;</span>

<span class="token comment">// é…ç½®å‚æ•°ç»“æ„</span>
<span class="token keyword">const</span> schema <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'object'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">properties</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'string'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// è·å–loaderå‚æ•°ï¼ˆæˆ–è€…å«é€‰é¡¹ï¼‰</span>
  <span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token function">getOptions</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> loaderName <span class="token operator">=</span> <span class="token string">'Example Loader'</span>

  <span class="token comment">/**
   * @description: æ ¡éªŒoptionsæ ¼å¼æ˜¯å¦æ­£ç¡®
   * @param {*} schema æ¨¡ç‰ˆ
   * @param {*} options å‚æ•°
   * @param {string} loaderName loaderå
   */</span>
  <span class="token function">validateOptions</span><span class="token punctuation">(</span>schema<span class="token punctuation">,</span> options<span class="token punctuation">,</span> loaderName<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// å¯¹èµ„æºåº”ç”¨ä¸€äº›è½¬æ¢â€¦â€¦</span>

  <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">export default </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span> <span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>ç¤ºä¾‹ï¼šbanner-loader</p> <h3 id="è¿”å›å…¶å®ƒç»“æœ"><a href="#è¿”å›å…¶å®ƒç»“æœ" class="header-anchor">#</a> è¿”å›å…¶å®ƒç»“æœ</h3> <p>ä¸Šé¢çš„ Loader éƒ½åªæ˜¯è¿”å›äº†åŸå†…å®¹è½¬æ¢åçš„å†…å®¹ï¼Œä½†æœ‰äº›åœºæ™¯ä¸‹è¿˜éœ€è¦è¿”å›é™¤äº†å†…å®¹ä¹‹å¤–çš„ä¸œè¥¿ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// é€šè¿‡ this.callback å‘Šè¯‰ Webpack è¿”å›çš„ç»“æœ</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> source<span class="token punctuation">,</span> sourceMaps<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// å½“ä½ ä½¿ç”¨ this.callback è¿”å›å†…å®¹æ—¶ï¼Œè¯¥ Loader å¿…é¡»è¿”å› undefinedï¼Œ</span>
  <span class="token comment">// ä»¥è®© Webpack çŸ¥é“è¯¥ Loader è¿”å›çš„ç»“æœåœ¨ this.callback ä¸­ï¼Œè€Œä¸æ˜¯ return ä¸­ </span>
  <span class="token keyword">return</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>å…¶ä¸­çš„ this.callback æ˜¯ Webpack ç»™ Loader æ³¨å…¥çš„ APIï¼Œä»¥æ–¹ä¾¿ Loader å’Œ Webpack ä¹‹é—´é€šä¿¡ã€‚this.callback çš„è¯¦ç»†ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">callback</span><span class="token punctuation">(</span>
    <span class="token comment">// å½“æ— æ³•è½¬æ¢åŸå†…å®¹æ—¶ï¼Œç»™ Webpack è¿”å›ä¸€ä¸ª Error</span>
    <span class="token literal-property property">err</span><span class="token operator">:</span> Error <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    <span class="token comment">// åŸå†…å®¹è½¬æ¢åçš„å†…å®¹</span>
    <span class="token literal-property property">content</span><span class="token operator">:</span> string <span class="token operator">|</span> Buffer<span class="token punctuation">,</span>
    <span class="token comment">// ç”¨äºæŠŠè½¬æ¢åçš„å†…å®¹å¾—å‡ºåŸå†…å®¹çš„ Source Mapï¼Œæ–¹ä¾¿è°ƒè¯•</span>
    sourceMap<span class="token operator">?</span><span class="token operator">:</span> SourceMap<span class="token punctuation">,</span>
    <span class="token comment">// å¦‚æœæœ¬æ¬¡è½¬æ¢ä¸ºåŸå†…å®¹ç”Ÿæˆäº† AST è¯­æ³•æ ‘ï¼Œå¯ä»¥æŠŠè¿™ä¸ª AST è¿”å›ï¼Œ</span>
    <span class="token comment">// ä»¥æ–¹ä¾¿ä¹‹åéœ€è¦ AST çš„ Loader å¤ç”¨è¯¥ ASTï¼Œä»¥é¿å…é‡å¤ç”Ÿæˆ ASTï¼Œæå‡æ€§èƒ½</span>
    abstractSyntaxTree<span class="token operator">?</span><span class="token operator">:</span> <span class="token constant">AST</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>ç¤ºä¾‹ï¼šbanner-loader</p> <h3 id="åŒæ­¥ä¸å¼‚æ­¥"><a href="#åŒæ­¥ä¸å¼‚æ­¥" class="header-anchor">#</a> åŒæ­¥ä¸å¼‚æ­¥</h3> <p>Loader æœ‰åŒæ­¥å’Œå¼‚æ­¥ä¹‹åˆ†ï¼Œä¸Šé¢ä»‹ç»çš„ Loader éƒ½æ˜¯åŒæ­¥çš„ Loaderï¼Œå› ä¸ºå®ƒä»¬çš„è½¬æ¢æµç¨‹éƒ½æ˜¯åŒæ­¥çš„ï¼Œè½¬æ¢å®Œæˆåå†è¿”å›ç»“æœã€‚ ä½†åœ¨æœ‰äº›åœºæ™¯ä¸‹è½¬æ¢çš„æ­¥éª¤åªèƒ½æ˜¯å¼‚æ­¥å®Œæˆçš„ï¼Œå¦‚æœé‡‡ç”¨åŒæ­¥çš„æ–¹å¼ç½‘ç»œè¯·æ±‚å°±ä¼šé˜»å¡æ•´ä¸ªæ„å»ºï¼Œå¯¼è‡´æ„å»ºéå¸¸ç¼“æ…¢ã€‚</p> <p>åœ¨è½¬æ¢æ­¥éª¤æ˜¯å¼‚æ­¥æ—¶ï¼Œå¯ä»¥è¿™æ ·ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// å‘Šè¯‰ Webpack æœ¬æ¬¡è½¬æ¢æ˜¯å¼‚æ­¥çš„ï¼ŒLoader ä¼šåœ¨ callback ä¸­å›è°ƒç»“æœ</span>
    <span class="token keyword">var</span> callback <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">async</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">someAsyncOperation</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> result<span class="token punctuation">,</span> sourceMaps<span class="token punctuation">,</span> ast</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// é€šè¿‡ callback è¿”å›å¼‚æ­¥æ‰§è¡Œåçš„ç»“æœ</span>
        <span class="token function">callback</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> result<span class="token punctuation">,</span> sourceMaps<span class="token punctuation">,</span> ast<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>ç¤ºä¾‹ï¼šbabel-loader | banner-loader</p> <h3 id="å¤„ç†äºŒè¿›åˆ¶æ•°æ®"><a href="#å¤„ç†äºŒè¿›åˆ¶æ•°æ®" class="header-anchor">#</a> å¤„ç†äºŒè¿›åˆ¶æ•°æ®</h3> <p>åœ¨é»˜è®¤çš„æƒ…å†µä¸‹ï¼ŒWebpack ä¼ ç»™ Loader çš„åŸå†…å®¹éƒ½æ˜¯ UTF-8 æ ¼å¼ç¼–ç çš„å­—ç¬¦ä¸²ã€‚ ä½†æœ‰äº›åœºæ™¯ä¸‹ Loader ä¸æ˜¯å¤„ç†æ–‡æœ¬æ–‡ä»¶ï¼Œè€Œæ˜¯å¤„ç†äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä¾‹å¦‚è¯»å–å›¾ç‰‡ï¼Œå°±éœ€è¦ Webpack ç»™ Loader ä¼ å…¥äºŒè¿›åˆ¶æ ¼å¼çš„æ•°æ®ã€‚ ä¸ºæ­¤ï¼Œä½ éœ€è¦è¿™æ ·ç¼–å†™ Loaderï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// åœ¨ exports.raw === true æ—¶ï¼ŒWebpack ä¼ ç»™ Loader çš„ source æ˜¯ Buffer ç±»å‹çš„</span>
    source <span class="token keyword">instanceof</span> <span class="token class-name">Buffer</span> <span class="token operator">===</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token comment">// Loader è¿”å›çš„ç±»å‹ä¹Ÿå¯ä»¥æ˜¯ Buffer ç±»å‹çš„</span>
    <span class="token comment">// åœ¨ exports.raw !== true æ—¶ï¼ŒLoader ä¹Ÿå¯ä»¥è¿”å› Buffer ç±»å‹çš„ç»“æœ</span>
    <span class="token keyword">return</span> source<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// é€šè¿‡ exports.raw å±æ€§å‘Šè¯‰ Webpack è¯¥ Loader æ˜¯å¦éœ€è¦äºŒè¿›åˆ¶æ•°æ® </span>
module<span class="token punctuation">.</span>exports<span class="token punctuation">.</span>raw <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
</code></pre></div><p>ç¤ºä¾‹ï¼šfile-loader</p> <h3 id="loader-ä¾èµ–"><a href="#loader-ä¾èµ–" class="header-anchor">#</a> loader ä¾èµ–</h3> <p>å¦‚æœä¸€ä¸ª loader ä½¿ç”¨å¤–éƒ¨èµ„æºï¼ˆä¾‹å¦‚ï¼Œä»æ–‡ä»¶ç³»ç»Ÿè¯»å–ï¼‰ï¼Œå¿…é¡»å£°æ˜ä¾èµ–ï¼Œå› ä¸ºè¿™ä¸ªæ–‡ä»¶æ˜¯åœ¨loaderå†…éƒ¨è¯»å–çš„ï¼Œå’Œwebpacké€’å½’æŸ¥æ‰¾ä¾èµ–æ¨¡å—æ˜¯æ²¡æœ‰å…³ç³»çš„ã€‚</p> <p>å¯¼è‡´çš„é—®é¢˜ï¼š
å½“ä¿®æ”¹äº†æ–‡ä»¶ï¼Œwebpackå¹¶ä¸ä¼šè®¤ä¸ºæœ‰ä¾èµ–å‘ç”Ÿäº†å˜åŒ–ï¼Œä¼šè¿”å› Loader çš„ç¼“å­˜ç»“æœï¼Œå¯¼è‡´æ‰“åŒ…åæ–‡ä»¶æ²¡å˜åŒ–ã€‚</p> <p>è§£å†³åŠæ³•ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> path <span class="token keyword">from</span> <span class="token string">'path'</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> callback <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">async</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// loaderå¼•ç”¨çš„æ–‡ä»¶</span>
  <span class="token keyword">var</span> headerPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'header.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// æŠŠæ–‡ä»¶æ·»åŠ åˆ°webpackä¾èµ–</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addDependency</span><span class="token punctuation">(</span>headerPath<span class="token punctuation">)</span><span class="token punctuation">;</span>

  fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>headerPath<span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> header</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">callback</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> header <span class="token operator">+</span> <span class="token string">&quot;\n&quot;</span> <span class="token operator">+</span> source<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>ç¤ºä¾‹ï¼šbanner-loader</p> <h3 id="loader-ç¼“å­˜åŠ é€Ÿ"><a href="#loader-ç¼“å­˜åŠ é€Ÿ" class="header-anchor">#</a> loader ç¼“å­˜åŠ é€Ÿ</h3> <p>åœ¨æœ‰äº›æƒ…å†µä¸‹ï¼Œæœ‰äº›è½¬æ¢æ“ä½œéœ€è¦å¤§é‡è®¡ç®—éå¸¸è€—æ—¶ï¼Œå¦‚æœæ¯æ¬¡æ„å»ºéƒ½é‡æ–°æ‰§è¡Œé‡å¤çš„è½¬æ¢æ“ä½œï¼Œæ„å»ºå°†ä¼šå˜å¾—éå¸¸ç¼“æ…¢ã€‚ ä¸ºæ­¤ï¼ŒWebpack ä¼šé»˜è®¤ç¼“å­˜æ‰€æœ‰ Loader çš„å¤„ç†ç»“æœï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨éœ€è¦è¢«å¤„ç†çš„æ–‡ä»¶æˆ–è€…å…¶ä¾èµ–çš„æ–‡ä»¶æ²¡æœ‰å‘ç”Ÿå˜åŒ–æ—¶ï¼Œ æ˜¯ä¸ä¼šé‡æ–°è°ƒç”¨å¯¹åº”çš„ Loader å»æ‰§è¡Œè½¬æ¢æ“ä½œçš„ã€‚</p> <p>å¦‚æœæƒ³è®© Webpack ä¸ç¼“å­˜è¯¥ Loader çš„å¤„ç†ç»“æœï¼Œå¯ä»¥è¿™æ ·ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// å…³é—­è¯¥ Loader çš„ç¼“å­˜åŠŸèƒ½</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">cacheable</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> source<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>ç¤ºä¾‹ï¼šbanner-loader</p> <h3 id="æ¨¡å—ä¾èµ–"><a href="#æ¨¡å—ä¾èµ–" class="header-anchor">#</a> æ¨¡å—ä¾èµ–</h3> <p>æ ¹æ®æ¨¡å—ç±»å‹ï¼Œå¯èƒ½ä¼šæœ‰ä¸åŒçš„æ¨¡å¼æŒ‡å®šä¾èµ–å…³ç³»ã€‚ä¾‹å¦‚åœ¨ CSS ä¸­ï¼Œä½¿ç”¨ @import å’Œ url(...) è¯­å¥æ¥å£°æ˜ä¾èµ–ã€‚è¿™äº›ä¾èµ–å…³ç³»åº”è¯¥ç”±æ¨¡å—ç³»ç»Ÿè§£æã€‚</p> <p>å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼ä¸­çš„ä¸€ç§æ¥å®ç°ï¼š</p> <ul><li><p>é€šè¿‡æŠŠå®ƒä»¬è½¬åŒ–æˆ require è¯­å¥ã€‚</p></li> <li><p>ä½¿ç”¨ this.resolve å‡½æ•°è§£æè·¯å¾„ã€‚</p></li></ul> <p>ç¤ºä¾‹ï¼šcss-loader</p> <h3 id="loaderçš„æ‰§è¡Œé¡ºåº"><a href="#loaderçš„æ‰§è¡Œé¡ºåº" class="header-anchor">#</a> loaderçš„æ‰§è¡Œé¡ºåº</h3> <p>é™¤äº†configä¸­çš„loaderï¼Œè¿˜å¯ä»¥å†™inlineçš„loaderï¼Œé‚£ä¹ˆloaderæ‰§è¡Œçš„å…ˆåé¡ºåºæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p> <p>å½“webpack.config.jsé…ç½®å¦‚ä¸‹æ—¶ï¼Œå…¶é¡ºåºä¸º loaderæ‰§è¡Œé¡ºåº pre &gt; normal &gt; post</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
    <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">'pre-loader'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">enforce</span><span class="token operator">:</span><span class="token string">'pre'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
    <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">'loader'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
    <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">'post-loader'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">enforce</span><span class="token operator">:</span><span class="token string">'post'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre></div><h4 id="è¡Œå†…loader"><a href="#è¡Œå†…loader" class="header-anchor">#</a> è¡Œå†…loader</h4> <p>ä¿®æ”¹main.js ä½¿ç”¨è¡Œå†…loaderåŠ è½½ä¸€ä¸ªjsæ–‡ä»¶</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> show <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'inline-loader!./src/js/show.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">show</span><span class="token punctuation">(</span><span class="token string">'WEBPACK'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>æ‰§è¡Œåé¡ºåºç»“æœæ˜¯ï¼š pre &gt; normal &gt; inline &gt; post</p> <p>åœ¨loaderä¸­logå¾—åˆ°ç»“æœï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code>pre<span class="token operator">-</span>loader <span class="token keyword">for</span> main<span class="token punctuation">.</span>js
loader <span class="token keyword">for</span> main<span class="token punctuation">.</span>js
post<span class="token operator">-</span>loader <span class="token keyword">for</span> main<span class="token punctuation">.</span>js
pre<span class="token operator">-</span>loader <span class="token keyword">for</span> show<span class="token punctuation">.</span>js
loader <span class="token keyword">for</span> show<span class="token punctuation">.</span>js
line<span class="token operator">-</span>loader <span class="token keyword">for</span> show<span class="token punctuation">.</span>js
post<span class="token operator">-</span>loader <span class="token keyword">for</span> show<span class="token punctuation">.</span>js
</code></pre></div><p>æˆ‘ä»¬è¿˜å¯ä»¥åœ¨è¡Œå†…loaderå‰åŠ å‰ç¼€ï¼Œä¿®æ”¹ä»–çš„æ‰§è¡Œæ–¹å¼ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// -!çš„è¡Œå†…loaderä¸ä¼šèµ° preå’Œnormal Loader</span>
<span class="token keyword">const</span> show <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'-!inline-loader!./src/js/show.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// æ‰§è¡Œé¡ºåºå¦‚ä¸‹ï¼š</span>
pre<span class="token operator">-</span>loader <span class="token keyword">for</span> main<span class="token punctuation">.</span>js
loader <span class="token keyword">for</span> main<span class="token punctuation">.</span>js
post<span class="token operator">-</span>loader <span class="token keyword">for</span> main<span class="token punctuation">.</span>js
line<span class="token operator">-</span>loader <span class="token keyword">for</span> show<span class="token punctuation">.</span>js
post<span class="token operator">-</span>loader <span class="token keyword">for</span> show<span class="token punctuation">.</span>js

<span class="token comment">// !çš„è¡Œå†…loaderä¸ä¼šèµ° normal Loader</span>
<span class="token keyword">const</span> show <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'!inline-loader!./src/js/show.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// æ‰§è¡Œé¡ºåºå¦‚ä¸‹ï¼š</span>
pre<span class="token operator">-</span>loader <span class="token keyword">for</span> main<span class="token punctuation">.</span>js
loader <span class="token keyword">for</span> main<span class="token punctuation">.</span>js
post<span class="token operator">-</span>loader <span class="token keyword">for</span> main<span class="token punctuation">.</span>js
pre<span class="token operator">-</span>loader <span class="token keyword">for</span> show<span class="token punctuation">.</span>js
line<span class="token operator">-</span>loader <span class="token keyword">for</span> show<span class="token punctuation">.</span>js
post<span class="token operator">-</span>loader <span class="token keyword">for</span> show<span class="token punctuation">.</span>js

<span class="token comment">// !!çš„è¡Œå†…loader åªä¼šèµ°è¡Œå†… Loaer</span>
<span class="token keyword">const</span> show <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'!!inline-loader!./src/js/show.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// æ‰§è¡Œé¡ºåºå¦‚ä¸‹ï¼š</span>
pre<span class="token operator">-</span>loader <span class="token keyword">for</span> main<span class="token punctuation">.</span>js
loader <span class="token keyword">for</span> main<span class="token punctuation">.</span>js
post<span class="token operator">-</span>loader <span class="token keyword">for</span> main<span class="token punctuation">.</span>js
line<span class="token operator">-</span>loader <span class="token keyword">for</span> show<span class="token punctuation">.</span>js
</code></pre></div><h3 id="loader-picthæ–¹æ³•"><a href="#loader-picthæ–¹æ³•" class="header-anchor">#</a> loader picthæ–¹æ³•</h3> <p>loader å…¶å®æ˜¯ç”±ä¸¤éƒ¨åˆ†ç»„æˆçš„ pitchå’Œnormalï¼Œæˆ‘ä»¬ä¸Šé¢æ‰€è¯´çš„éƒ½æ˜¯normaléƒ¨åˆ†ã€‚</p> <p>ä¸‹é¢ä»‹ç»pitchå’Œnormalçš„å…³ç³»ï¼š</p> <p>åœ¨æ‰§è¡Œloaderçš„æ—¶å€™ï¼Œä¼šå…ˆæ‰§è¡Œpitchï¼Œpitchæ‰§è¡Œçš„é¡ºåºä¸æˆ‘ä»¬åˆšåˆšçœ‹çš„normalå®Œå…¨ç›¸åã€‚</p> <p>pitchæ‰§è¡Œåä¼šå»è·å–åˆ°sourceï¼Œå†å°†sourceä¼ å›ç»™normalã€‚</p> <p><img src="./assets/img/5.52053705.png" alt="image"></p> <p>å½“pitchä¸­æœ‰è¿”å›å€¼çš„æ—¶å€™ï¼Œä¸€åˆ‡éƒ½å˜äº†ã€‚</p> <p>å¦‚å›¾ï¼Œloader2çš„pitchæœ‰è¿”å›å€¼ï¼Œé‚£ä¹ˆç›´æ¥è·³è¿‡åé¢çš„pitchä»¥åŠnormalï¼Œç›´æ¥åˆ°loader1çš„normalã€‚ä¹Ÿå°±æ˜¯å¯¹loaderæœ‰ä¸€ä¸ªé˜»æ–­çš„åŠŸèƒ½ã€‚</p> <p><img src="./assets/img/6.a5c1081f.png" alt="image"></p> <p>è¿™äº› pitch å‡½æ•°å¹¶ä¸æ˜¯ç”¨æ¥å®é™…å¤„ç† module çš„å†…å®¹çš„ï¼Œä¸»è¦æ˜¯å¯ä»¥åšä¸€äº›æ‹¦æˆªå¤„ç†çš„å·¥ä½œï¼Œä»è€Œè¾¾åˆ°åœ¨ loader å¤„ç†æµç¨‹å½“ä¸­çš„ä¸€äº›å®šåˆ¶åŒ–çš„å¤„ç†éœ€è¦ã€‚</p> <h3 id="astè¯­æ³•æ ‘"><a href="#astè¯­æ³•æ ‘" class="header-anchor">#</a> ASTè¯­æ³•æ ‘</h3> <p>æ‡‚äº†loaderçš„ç¼–å†™è§„åˆ™åï¼Œæˆ‘ä»¬è¿˜éœ€è¦äº†è§£ASTè¯­æ³•æ ‘ï¼Œæœ‰äº†è¿™ä¸ªé»‘é­”æ³•ï¼Œæˆ‘ä»¬å°±èƒ½ä¸ºæ‰€æ¬²ä¸ºçš„æ“çºµä»£ç ã€‚</p> <h4 id="ä»€ä¹ˆæ˜¯astè¯­æ³•æ ‘"><a href="#ä»€ä¹ˆæ˜¯astè¯­æ³•æ ‘" class="header-anchor">#</a> ä»€ä¹ˆæ˜¯ASTè¯­æ³•æ ‘</h4> <p>æ ¹æ®ç¼–ç¨‹è¯­è¨€çš„è¯­æ³•è¡¨ç¤ºæºä»£ç ç»“æ„ï¼Œæ¯ä¸ªASTèŠ‚ç‚¹å¯¹åº”äºä¸€ä¸ªæºä»£ç é¡¹ï¼Œå¦‚å›¾ï¼š</p> <p><img src="./assets/img/8.ce57752e.png" alt="image"></p> <p>å®é™…ä¸Šï¼Œæ­£çœŸASTæ¯ä¸ªèŠ‚ç‚¹ä¼šæœ‰æ›´å¤šçš„ä¿¡æ¯ã€‚ä½†æ˜¯ï¼Œè¿™æ˜¯å¤§ä½“æ€æƒ³ã€‚ä»çº¯æ–‡æœ¬ä¸­ï¼Œæˆ‘ä»¬å°†å¾—åˆ°æ ‘å½¢ç»“æ„çš„æ•°æ®ã€‚æ¯ä¸ªæ¡ç›®å’Œæ ‘ä¸­çš„èŠ‚ç‚¹ä¸€ä¸€å¯¹åº”ã€‚</p> <h4 id="æ€ä¹ˆå¾—åˆ°astè¯­æ³•æ ‘"><a href="#æ€ä¹ˆå¾—åˆ°astè¯­æ³•æ ‘" class="header-anchor">#</a> æ€ä¹ˆå¾—åˆ°ASTè¯­æ³•æ ‘</h4> <p>ç¬¬ä¸€æ­¥ï¼Œè¯æ³•åˆ†æï¼Œä¹Ÿå«åšæ‰«æscannerã€‚å®ƒè¯»å–æˆ‘ä»¬çš„ä»£ç ï¼Œç„¶åæŠŠå®ƒä»¬æŒ‰ç…§é¢„å®šçš„è§„åˆ™åˆå¹¶æˆä¸€ä¸ªä¸ªçš„æ ‡è¯†tokensï¼ˆè¯æ³•å•å…ƒï¼‰ã€‚åŒæ—¶ï¼Œå®ƒä¼šç§»é™¤ç©ºç™½ç¬¦ï¼Œæ³¨é‡Šç­‰ã€‚æœ€åï¼Œæ•´ä¸ªä»£ç å°†è¢«åˆ†å‰²è¿›ä¸€ä¸ªtokensåˆ—è¡¨ï¼ˆæˆ–è€…è¯´ä¸€ç»´æ•°ç»„ï¼‰ã€‚</p> <p><img src="./assets/img/9.e748f372.png" alt="image"></p> <p>ç¬¬äºŒæ­¥ï¼Œè¯­æ³•åˆ†æï¼Œä¹Ÿè§£æå™¨ã€‚å®ƒä¼šå°†è¯æ³•åˆ†æå‡ºæ¥çš„æ•°ç»„è½¬åŒ–æˆæ ‘å½¢çš„è¡¨è¾¾å½¢å¼ã€‚åŒæ—¶ï¼ŒéªŒè¯è¯­æ³•ï¼Œè¯­æ³•å¦‚æœæœ‰é”™çš„è¯ï¼ŒæŠ›å‡ºè¯­æ³•é”™è¯¯ã€‚</p> <p><img src="./assets/img/10.18900e19.png" alt="image"></p> <p>å½“ç”Ÿæˆæ ‘çš„æ—¶å€™ï¼Œè§£æå™¨ä¼šåˆ é™¤ä¸€äº›æ²¡å¿…è¦çš„æ ‡è¯†tokensï¼ˆæ¯”å¦‚ä¸å®Œæ•´çš„æ‹¬å·ï¼‰ï¼Œå› æ­¤ASTä¸æ˜¯100%ä¸æºç åŒ¹é…çš„ã€‚è¯´ä¸ªé¢˜å¤–è¯ï¼Œè§£æå™¨100%è¦†ç›–æ‰€æœ‰ä»£ç ç»“æ„ç”Ÿæˆæ ‘å«åšCSTï¼ˆå…·ä½“è¯­æ³•æ ‘ï¼‰</p> <p><img src="./assets/img/11.94d381b0.png" alt="image"></p> <h4 id="é€šè¿‡astä¿®æ”¹æºä»£ç "><a href="#é€šè¿‡astä¿®æ”¹æºä»£ç " class="header-anchor">#</a> é€šè¿‡ASTä¿®æ”¹æºä»£ç </h4> <p>3ä¸ªé˜¶æ®µè¿è¡Œä»£ç ï¼šè§£æï¼ˆparsingï¼‰ï¼Œè½¬è¯‘ï¼ˆtransformingï¼‰ï¼Œç”Ÿæˆï¼ˆgenerationï¼‰</p> <p><img src="./assets/img/12.f828c3bb.png" alt="image"></p> <h4 id="ç¬¬ä¸‰æ–¹åº“ä»¥åŠè°ƒè¯•å·¥å…·"><a href="#ç¬¬ä¸‰æ–¹åº“ä»¥åŠè°ƒè¯•å·¥å…·" class="header-anchor">#</a> ç¬¬ä¸‰æ–¹åº“ä»¥åŠè°ƒè¯•å·¥å…·</h4> <ul><li>@babel/parser æŠŠæºç è½¬ä¸ºast</li> <li>@babel/traverse éå†åˆ°å¯¹åº”èŠ‚ç‚¹</li> <li>@babel/types èŠ‚ç‚¹æ›¿æ¢</li> <li>@babel/generator ç”Ÿæˆç»“æœ</li></ul> <p>å½“æˆ‘ä»¬æƒ³çœ‹è‡ªå·±ä»£ç çš„ASTæ—¶ï¼Œå¯ä»¥åœ¨ https://astexplorer.net/ ä¸­æŸ¥çœ‹</p> <h2 id="loader-ç¼–å†™ç¤ºä¾‹"><a href="#loader-ç¼–å†™ç¤ºä¾‹" class="header-anchor">#</a> loader ç¼–å†™ç¤ºä¾‹</h2> <h3 id="try-catch-loadere"><a href="#try-catch-loadere" class="header-anchor">#</a> try/catch loadere</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> parser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@babel/parser&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> traverse <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@babel/traverse&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>default<span class="token punctuation">;</span>
<span class="token keyword">const</span> t <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@babel/types&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// @babel/parser æŠŠæºç è½¬ä¸ºast</span>
<span class="token comment">// @babel/traverse éå†åˆ°å¯¹åº”èŠ‚ç‚¹</span>
<span class="token comment">// @babel/types èŠ‚ç‚¹æ›¿æ¢</span>

<span class="token keyword">const</span> core <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@babel/core&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> loaderUtils <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;loader-utils&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token constant">DEFAULT</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">catchCode</span><span class="token operator">:</span> <span class="token parameter">identifier</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">console.error(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>identifier<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
  <span class="token literal-property property">identifier</span><span class="token operator">:</span> <span class="token string">&quot;e&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">finallyCode</span><span class="token operator">:</span> <span class="token keyword">null</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * å‚æ•°æ»¡è¶³å«æœ‰ async å…³é”®å­—çš„
 * å‡½æ•°å£°æ˜
 * ç®­å¤´å‡½æ•°
 * å‡½æ•°è¡¨è¾¾å¼
 * æ–¹æ³•
 * åˆ™è¿”å› true
 * **/</span>

<span class="token keyword">const</span> <span class="token function-variable function">isAsyncFuncNode</span> <span class="token operator">=</span> <span class="token parameter">node</span> <span class="token operator">=&gt;</span>
  t<span class="token punctuation">.</span><span class="token function">isFunctionDeclaration</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">async</span><span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">||</span>
  t<span class="token punctuation">.</span><span class="token function">isArrowFunctionExpression</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">async</span><span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">||</span>
  t<span class="token punctuation">.</span><span class="token function">isFunctionExpression</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">async</span><span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">||</span>
  t<span class="token punctuation">.</span><span class="token function">isObjectMethod</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">async</span><span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> options <span class="token operator">=</span> loaderUtils<span class="token punctuation">.</span><span class="token function">getOptions</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> ast <span class="token operator">=</span> parser<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">sourceType</span><span class="token operator">:</span> <span class="token string">&quot;module&quot;</span><span class="token punctuation">,</span> <span class="token comment">// æ”¯æŒ es6 module</span>
    <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;dynamicImport&quot;</span><span class="token punctuation">]</span> <span class="token comment">// æ”¯æŒåŠ¨æ€ import</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  options <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span><span class="token constant">DEFAULT</span><span class="token punctuation">,</span>
    <span class="token operator">...</span>options
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> options<span class="token punctuation">.</span>catchCode <span class="token operator">===</span> <span class="token string">&quot;function&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    options<span class="token punctuation">.</span>catchCode <span class="token operator">=</span> options<span class="token punctuation">.</span><span class="token function">catchCode</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>identifier<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">let</span> catchNode <span class="token operator">=</span> parser<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>catchCode<span class="token punctuation">)</span><span class="token punctuation">.</span>program<span class="token punctuation">.</span>body<span class="token punctuation">;</span>
  <span class="token keyword">let</span> finallyNode <span class="token operator">=</span>
    options<span class="token punctuation">.</span>finallyCode <span class="token operator">&amp;&amp;</span> parser<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>finallyCode<span class="token punctuation">)</span><span class="token punctuation">.</span>program<span class="token punctuation">.</span>body<span class="token punctuation">;</span>

  <span class="token comment">/**
   *  åªç»™æœ€å¤–å±‚çš„ async å‡½æ•°åŒ…è£¹ try/catch
   * **/</span>
  <span class="token function">traverse</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token comment">// å¯»æ‰¾åˆ°awaitè¡¨è¾¾å¼</span>
    <span class="token function">AwaitExpression</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// é€’å½’å‘ä¸Šæ‰¾å¼‚æ­¥å‡½æ•°çš„ node èŠ‚ç‚¹</span>
      <span class="token keyword">while</span> <span class="token punctuation">(</span>path <span class="token operator">&amp;&amp;</span> path<span class="token punctuation">.</span>node<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> parentPath <span class="token operator">=</span> path<span class="token punctuation">.</span>parentPath<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>
          <span class="token comment">// æ˜¯å¦ä¸ºå—è¯­å¥ä¸”æ˜¯å¦ async</span>
          t<span class="token punctuation">.</span><span class="token function">isBlockStatement</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span>node<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
          <span class="token function">isAsyncFuncNode</span><span class="token punctuation">(</span>parentPath<span class="token punctuation">.</span>node<span class="token punctuation">)</span>
        <span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">let</span> tryCatchAst <span class="token operator">=</span> t<span class="token punctuation">.</span><span class="token function">tryStatement</span><span class="token punctuation">(</span>
            path<span class="token punctuation">.</span>node<span class="token punctuation">,</span>
            t<span class="token punctuation">.</span><span class="token function">catchClause</span><span class="token punctuation">(</span>
              t<span class="token punctuation">.</span><span class="token function">identifier</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>identifier<span class="token punctuation">)</span><span class="token punctuation">,</span>
              t<span class="token punctuation">.</span><span class="token function">blockStatement</span><span class="token punctuation">(</span>catchNode<span class="token punctuation">)</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            finallyNode <span class="token operator">&amp;&amp;</span> t<span class="token punctuation">.</span><span class="token function">blockStatement</span><span class="token punctuation">(</span>finallyNode<span class="token punctuation">)</span>
          <span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token comment">// èŠ‚ç‚¹æ›¿æ¢</span>
          path<span class="token punctuation">.</span><span class="token function">replaceWithMultiple</span><span class="token punctuation">(</span><span class="token punctuation">[</span>tryCatchAst<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>
          <span class="token comment">// å·²ç»åŒ…å« try è¯­å¥åˆ™ç›´æ¥é€€å‡º</span>
          t<span class="token punctuation">.</span><span class="token function">isBlockStatement</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span>node<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
          t<span class="token punctuation">.</span><span class="token function">isTryStatement</span><span class="token punctuation">(</span>parentPath<span class="token punctuation">.</span>node<span class="token punctuation">)</span>
        <span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        path <span class="token operator">=</span> parentPath<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> core<span class="token punctuation">.</span><span class="token function">transformFromAstSync</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">configFile</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token comment">// å±è”½ babel.config.jsï¼Œå¦åˆ™ä¼šæ³¨å…¥ polyfill ä½¿å¾—è°ƒè¯•å˜å¾—å›°éš¾</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>code<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="less-css-style-loaderé“¾å¤„ç†lessæ ·å¼"><a href="#less-css-style-loaderé“¾å¤„ç†lessæ ·å¼" class="header-anchor">#</a> less/css/style loaderé“¾å¤„ç†lessæ ·å¼</h3> <div class="language-js extra-class"><pre class="language-js"><code>less<span class="token operator">-</span>loader<span class="token punctuation">.</span>js

<span class="token keyword">let</span> less <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'less'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">lessloader</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  less<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">callback</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">callback</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> result<span class="token punctuation">.</span>css<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> lessloader
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code>css<span class="token operator">-</span>loader<span class="token punctuation">.</span>js

<span class="token keyword">function</span> <span class="token function">loader</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> reg <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">url\((.+?)\)</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> current <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>

  <span class="token comment">// jsè„šæœ¬å­—ç¬¦ä¸²</span>
  <span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'let list = []'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span>current <span class="token operator">=</span> reg<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// è¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œå…¶ä¸­å­˜æ”¾åŒ¹é…çš„ç»“æœ</span>
    <span class="token comment">// æ•°ç»„çš„ç¬¬ 0 ä¸ªå…ƒç´ æ˜¯ä¸æ­£åˆ™è¡¨è¾¾å¼ç›¸åŒ¹é…çš„æ–‡æœ¬</span>
    <span class="token comment">// ç¬¬ 1 ä¸ªå…ƒç´ æ˜¯ä¸ RegExpObject çš„ç¬¬ 1 ä¸ªå­è¡¨è¾¾å¼ç›¸åŒ¹é…çš„æ–‡æœ¬</span>
    <span class="token keyword">let</span> <span class="token punctuation">[</span>match<span class="token punctuation">,</span> url<span class="token punctuation">]</span> <span class="token operator">=</span> current<span class="token punctuation">;</span>

    <span class="token comment">// reg.lastIndex ä¸‹æ¬¡åŒ¹é…çš„èµ·å§‹ä½ç½®</span>
    <span class="token keyword">let</span> last <span class="token operator">=</span> reg<span class="token punctuation">.</span>lastIndex <span class="token operator">-</span> match<span class="token punctuation">.</span>length

    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>source<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> last<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>source<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> last<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    
    arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">list.push(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>source<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> last<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    index <span class="token operator">=</span> reg<span class="token punctuation">.</span>lastIndex<span class="token punctuation">;</span>

    <span class="token comment">// å†æŠŠurlå¼•ç”¨å›¾ç‰‡æ¢æˆrequireå†™æ³•</span>
    arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">list.push(&quot;url(&quot; + require(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">) + &quot;)&quot;)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">list.push(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>source<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">module.exports = list.join('')</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot;\r\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> arr<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot;\r\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> loader<span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code>style<span class="token operator">-</span>loader

<span class="token keyword">let</span> loaderUtils <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'loader-utils'</span><span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">styleloader</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// å¯¼å‡ºä¸€ä¸ªjsè„šæœ¬</span>

  <span class="token keyword">let</span> style <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
    let style = document.createElement(&quot;style&quot;);
    style.innerHTML = </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
    document.head.appendChild(style);
  </span><span class="token template-punctuation string">`</span></span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>style<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> style<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// remainingRequest å‰©ä½™çš„loader</span>
styleloader<span class="token punctuation">.</span><span class="token function-variable function">pitch</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">remainingRequest</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>remainingRequest<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// css-loader!less-loader!index.less</span>

  <span class="token comment">// è®©style-loader å»å¤„ç† </span>

  <span class="token comment">// è¿”å›ç›¸å¯¹è·¯å¾„</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>loaderUtils<span class="token punctuation">.</span><span class="token function">stringifyRequest</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>remainingRequest<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">let</span> style <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
    let style = document.createElement(&quot;style&quot;);
    style.innerHTML = require(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>loaderUtils<span class="token punctuation">.</span><span class="token function">stringifyRequest</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token string">'!!'</span><span class="token operator">+</span>remainingRequest<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)
    document.head.appendChild(style);
  </span><span class="token template-punctuation string">`</span></span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>style<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> style<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> styleloader<span class="token punctuation">;</span>
</code></pre></div><h2 id="æ–‡ä¸­æåˆ°çš„å…¶ä»–loaderä»£ç "><a href="#æ–‡ä¸­æåˆ°çš„å…¶ä»–loaderä»£ç " class="header-anchor">#</a> æ–‡ä¸­æåˆ°çš„å…¶ä»–loaderä»£ç ï¼š</h2> <p><strong>babel-loader.js</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> bable <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@babel/core&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// ä¸€ä¸ªloaderå·¥å…·</span>
<span class="token keyword">let</span> loaderUtils <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;loader-utils&quot;</span><span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">loader</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// è·å–ç”¨æˆ·ä¼ å…¥loaderå‚æ•°</span>
  <span class="token keyword">let</span> options <span class="token operator">=</span> loaderUtils<span class="token punctuation">.</span><span class="token function">getOptions</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> cb <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">async</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// loaderä¸Šä¸‹æ–‡ é»˜è®¤æœ‰asyncè¿™ä¸ªæ–¹æ³• å¼‚æ­¥æ‰§è¡Œ</span>

  <span class="token comment">// bableä»£ç è½¬æ¢</span>
  bable<span class="token punctuation">.</span><span class="token function">transform</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span><span class="token punctuation">{</span>
    <span class="token comment">// presets: [ '@bable/preset-env' ],</span>
    <span class="token operator">...</span>options<span class="token punctuation">,</span> <span class="token comment">//å¯¹è±¡å±•å¼€</span>
    <span class="token literal-property property">sourceMaps</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> loaderUtils<span class="token punctuation">.</span><span class="token function">interpolateName</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">'[name].[ext]'</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// æ–‡ä»¶å</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;err&quot;</span><span class="token operator">+</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">cb</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span>result<span class="token punctuation">.</span>code<span class="token punctuation">,</span>result<span class="token punctuation">.</span>map<span class="token punctuation">)</span> <span class="token comment">// å¼‚æ­¥</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> loader<span class="token punctuation">;</span>
</code></pre></div><p><strong>banner-loader.js</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> loaderUtils <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;loader-utils&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// æ ¡éªŒå‚æ•°çš„åº“</span>
<span class="token keyword">let</span> <span class="token punctuation">{</span> validate <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;schema-utils&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">loader</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> options <span class="token operator">=</span> loaderUtils<span class="token punctuation">.</span><span class="token function">getOptions</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> cb <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">async</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// å‚æ•°éª¨æ¶</span>
  <span class="token keyword">let</span> schema <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">'object'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">properties</span><span class="token operator">:</span><span class="token punctuation">{</span>
      <span class="token literal-property property">text</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">&quot;string&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">filename</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">&quot;string&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// æ ¡éªŒ </span>
  <span class="token function">validate</span><span class="token punctuation">(</span>schema<span class="token punctuation">,</span>options<span class="token punctuation">,</span><span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'banner-loader'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// this.cacheable(false);</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>filename<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// æŠŠæ–‡ä»¶æ·»åŠ åˆ°webpackä¾èµ–</span>
    <span class="token comment">// this.addDependency(options.filename);</span>
    fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>filename<span class="token punctuation">,</span><span class="token string">'utf8'</span><span class="token punctuation">,</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">cb</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/**</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>data<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">**/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>source<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
    <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/**</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>options<span class="token punctuation">.</span>text<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">**/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>source<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> loader<span class="token punctuation">;</span>
</code></pre></div><p><strong>file-loader.js</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> loaderUtils <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;loader-utils&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// æ‹¿åˆ°æ–‡ä»¶ï¼ˆå¦‚å›¾ç‰‡ï¼‰åå‘å°„åˆ°è¾“å‡ºè·¯å¾„ï¼Œå¹¶è¿”å›æ–‡ä»¶è·¯å¾„</span>
<span class="token keyword">function</span> <span class="token function">loader</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> source <span class="token keyword">instanceof</span> <span class="token class-name">Buffer</span> <span class="token operator">===</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// è·å–æ–‡ä»¶å</span>
  <span class="token keyword">let</span> fileName <span class="token operator">=</span> loaderUtils<span class="token punctuation">.</span><span class="token function">interpolateName</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">'[name].[ext]'</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// å‘å°„æ–‡ä»¶åˆ°æ‰“åŒ…æ–‡ä»¶å¤¹ä¸‹</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">emitFile</span><span class="token punctuation">(</span>fileName<span class="token punctuation">,</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// æŒ‡å‘disté‡Œçš„å›¾ç‰‡</span>
  <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">module.exports=&quot;./</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>fileName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;</span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">}</span>
<span class="token comment">// é€šè¿‡ exports.raw å±æ€§å‘Šè¯‰ Webpack è¯¥ Loader æ˜¯å¦éœ€è¦äºŒè¿›åˆ¶æ•°æ® </span>
loader<span class="token punctuation">.</span>raw <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> loader<span class="token punctuation">;</span>
</code></pre></div><h2 id="ç¼–å†™-pulgin-çš„å‰ç½®çŸ¥è¯†"><a href="#ç¼–å†™-pulgin-çš„å‰ç½®çŸ¥è¯†" class="header-anchor">#</a> ç¼–å†™ Pulgin çš„å‰ç½®çŸ¥è¯†</h2> <h3 id="tapable"><a href="#tapable" class="header-anchor">#</a> tapable</h3> <p>webpackæœ¬è´¨ä¸Šæ˜¯ä¸€ç§äº‹ä»¶æµçš„æœºåˆ¶ï¼Œä»–çš„å·¥ä½œæµç¨‹å°±æ˜¯å°†å„ä¸ªæ’ä»¶ä¸²è”ï¼Œè€Œå®ç°è¿™äº›çš„æ ¸å¿ƒéƒ¨åˆ†å°±æ˜¯tapableã€‚</p> <p>æŸ¥çœ‹webpackçš„æºç æˆ‘ä»¬å¯ä»¥çœ‹åˆ°åœ¨ç¼–è¯‘çš„ä¸»è¦æ ¸å¿ƒæ¨¡å—é‡Œï¼Œå¼•ç”¨äº†åŒæ­¥é’©å­å’Œå¼‚æ­¥é’©å­ï¼Œå¦‚å›¾ï¼š</p> <p>æŒ–ä¸ªå‘ï¼Œå¾…è¡¥å……...</p> <h2 id="è¡¥å……èµ„æ–™"><a href="#è¡¥å……èµ„æ–™" class="header-anchor">#</a> è¡¥å……èµ„æ–™ï¼š</h2> <ul><li><a href="https://www.bilibili.com/video/BV1a4411e7Bz?from=search&amp;seid=1342273522026746801" target="_blank" rel="noopener noreferrer">webpackæ•™ç¨‹ Bç«™è§†é¢‘<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://segmentfault.com/a/1190000018450503" target="_blank" rel="noopener noreferrer">Webpack Loader é«˜æ‰‹è¿›é˜¶<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/CodeLittlePrince/blog/issues/19" target="_blank" rel="noopener noreferrer">AST<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://zhuanlan.zhihu.com/p/102603497" target="_blank" rel="noopener noreferrer">webpack 4 æºç ä¸»æµç¨‹åˆ†æ<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.jianshu.com/p/b1dc21fc025a" target="_blank" rel="noopener noreferrer">try/catch loader<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">12/1/2020, 12:01:14 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/./dailyRecord/webpack.html" class="prev">
        webpack
      </a></span> <span class="next"><a href="/./dailyRecord/vite.html">
        vite
      </a>
      â†’
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="./assets/js/app.09835454.js" defer></script><script src="./assets/js/3.9a8cb714.js" defer></script><script src="./assets/js/7.39aba9d0.js" defer></script>
  </body>
</html>
